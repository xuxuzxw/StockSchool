### **《StockSchool - AI构建质检清单 (QC Checklist)》**



**质检核心思想**: 在AI辅助开发中，您的角色是“**首席质检官 (Chief Quality Officer)**”。您负责验证AI的交付成果是否满足设计要求，并在出现偏差时提出明确的修正指令。

| **阶段**             | **质检环节 (Checkpoint)**   | **检验方法 (Verification Method)**                           | **验收标准 (Acceptance Criteria)**                           |
| -------------------- | --------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **零：项目初始化**   | **1. 目录结构完整性**       | - **终端命令**: `ls -R stockschool/`<br>- **人工检查**: 目视检查输出结果。 | - 所有在【指令 1/13】中指定的目录和`__init__.py`文件都已正确创建。<br>- `requirements.txt`, `.env`, `docker-compose.yml`, `Dockerfile`等核心文件已存在。 |
| **一：数据库构建**   | **2. 依赖与Schema文件内容** | - **人工检查**: 打开`requirements.txt`和`database_schema.sql`文件。 | - `requirements.txt`内容与【指令 2/13】完全一致。<br>- `database_schema.sql`的SQL语法正确，包含了所有表、主键、索引和`create_hypertable`的定义。 |
|                      | **3. Docker环境配置**       | - **人工检查**: 逐一核对`Dockerfile`和`docker-compose.yml`的内容。<br>- **终端命令**: （在填写完`.env`后）`docker-compose config` | - 文件内容与【指令 3/13】的设计意图相符，特别是镜像名、数据卷、环境变量的使用。<br>- **数据库镜像版本**: 确保 `docker-compose.yml` 中 PostgreSQL 服务的镜像版本为 `timescale/timescaledb:latest-pg15`。<br>- **Python 版本**: 确保 `Dockerfile` 中 Python 的基础镜像版本为 `python:3.11-slim`。<br>- `docker-compose config`命令执行不报错，说明YAML语法正确。 |
|                      | **4. 数据库初始化状态**     | - **终端命令**: （在`docker-compose up`后）`docker ps`<br>- **数据库工具**: 使用DBeaver、DataGrip或`psql`连接到数据库。 | - `docker ps`显示`db`和`redis`容器正在健康运行(`running`)。<br>- 在数据库中能看到`stock_daily`, `financial_reports`, `sw_industry_history`等所有已定义的表。`stock_daily`表被正确识别为Hypertable。 |
| **二：数据管道实现** | **5. 通用工具代码质量**     | - **人工检查**: 阅读`src/utils/db.py`和`src/utils/retry.py`的源代码。 | - `get_db_engine`正确地从环境变量加载配置，并使用`db`作为主机名。<br>- `idempotent_retry`装饰器逻辑正确，包含异常捕获和延时等待。 |
|                      | **6. Tushare同步器功能**    | - **终端命令**: `python stockschool/src/data/tushare_sync.py`<br>- **数据库工具**: `SELECT COUNT(*) FROM stock_daily;` | - 脚本运行不报错，能看到打印出的同步日志。 - `stock_daily`表中的数据行数增加，说明数据已成功写入。 |
| **三：核心计算引擎** | **7. 因子与质量模块逻辑**   | - **人工检查**: 阅读`src/compute/technical.py`和`src/compute/quality.py`的源代码。 | - `calculate_rsi`等因子计算函数的数学逻辑与标准定义一致。<br>- `detect_outliers`函数的处理顺序正确（先ffill，再行业均值填充）。 |
|                      | **8. Celery任务队列**       | - **人工检查**: 阅读`celery_app.py`和`tasks.py`。<br>- **终端命令**: （在Docker容器内）`celery -A src.compute.celery_app worker -l info` | - Celery App的broker和backend地址配置正确。 - 任务函数被`@app.task`正确装饰。 - Celery worker可以正常启动并发现任务。 |
| **四：策略与智能化** | **9. 策略与日志模块**       | - **人工检查**: 阅读`evaluate.py`, `explain.py`, `log_config.py`和`alert.py`。 | - 策略评估函数的公式正确。 - 日志系统正确配置了文件和控制台两个Handler。 - 告警函数能正确读取webhook环境变量。 |
| **五：整合与收尾**   | **10. 单元测试通过率**      | - **终端命令**: `pytest stockschool/src/tests/`              | - **所有测试用例必须100%通过 (PASS)。** 任何失败(FAIL)或错误(ERROR)都必须修正后才能进入下一步。 |
|                      | **11. 主程序端到端运行**    | - **终端命令**: `python stockschool/src/main.py`             | - 主程序能顺利从头跑到尾，不抛出未捕获的异常。 - 控制台打印出的日志信息符合预期流程。 - （如果配置了webhook）能收到“Daily run completed successfully.”的告警消息。 |
