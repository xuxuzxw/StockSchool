# StockSchool é¡¹ç›®å¼€å‘æ—¥å¿—

## v1.1 é˜¶æ®µå¼€å‘è®°å½•

#### æ•°æ®åº“æ¶æ„å‡çº§
- âœ… **æ•°æ®åº“Schemaæ›´æ–°** - åœ¨`database_schema.sql`ä¸­æ·»åŠ äº†`sentiment_data`è¡¨ï¼Œç”¨äºå­˜å‚¨å¸‚åœºæƒ…ç»ªã€èµ„é‡‘æµå‘ç­‰æ•°æ®
- âœ… **é…ç½®æ–‡ä»¶æ›´æ–°** - åœ¨`config.yml`ä¸­æ·»åŠ äº†æƒ…ç»ªæ•°æ®ã€èµ„é‡‘æµå‘æ•°æ®å’ŒåŒ—å‘èµ„é‡‘æ•°æ®çš„åŒæ­¥é…ç½®å‚æ•°

#### æ•°æ®è¡¥å…¨ä¸å…¥åº“
- âœ… **åŸºç¡€æ•°æ®åŒæ­¥** - `tushare_sync.py`å·²å®ç°åŸºç¡€è‚¡ç¥¨æ•°æ®åŒæ­¥
- âœ… **æƒ…ç»ªæ•°æ®åŒæ­¥** - `akshare_sync.py`å·²å®ç°æƒ…ç»ªæ•°æ®åŒæ­¥åŠŸèƒ½
- ğŸ”„ **è´¢åŠ¡æ•°æ®è¡¥å…¨** - éœ€è¦å®Œå–„`tushare_sync.py`æ·»åŠ è´¢åŠ¡æ•°æ®å’ŒæŒ‡æ ‡æ•°æ®åŒæ­¥

#### æ ¸å¿ƒå› å­è®¡ç®—
- âœ… **æŠ€æœ¯å› å­è®¡ç®—** - `factor_engine.py`å·²å®ç°æŠ€æœ¯å› å­è®¡ç®—åŠŸèƒ½
- âœ… **åŸºæœ¬é¢æŒ‡æ ‡è®¡ç®—** - åœ¨`indicators.py`ä¸­æ·»åŠ äº†`FundamentalIndicators`ç±»å’Œ`FundamentalFactorCalculator`ç±»
- âœ… **åŸºæœ¬é¢å› å­é›†æˆ** - å‡çº§`factor_engine.py`ï¼Œæ·»åŠ äº†`_calculate_fundamental_factors`æ–¹æ³•å’Œ`calculate_all_factors_with_fundamental`æ–¹æ³•
- âœ… **å› å­é¢„å¤„ç†** - åˆ›å»ºäº†`processing.py`ï¼Œå®ç°å› å­æ ‡å‡†åŒ–ã€å»æå€¼ã€ä¸­æ€§åŒ–ç­‰é¢„å¤„ç†åŠŸèƒ½

#### AIæ¨¡å‹è®­ç»ƒä¸é¢„æµ‹
- âœ… **è®­ç»ƒæµæ°´çº¿** - åˆ›å»ºäº†`training_pipeline.py`ï¼Œå®ç°å®Œæ•´çš„æ¨¡å‹è®­ç»ƒæµæ°´çº¿
- âœ… **é¢„æµ‹è„šæœ¬** - åˆ›å»ºäº†`prediction.py`ï¼Œå®ç°æ¯æ—¥é¢„æµ‹åŠŸèƒ½







---

- **v1.1.6 å…¨æµç¨‹å®æµ‹é˜¶æ®µå®Œæˆ**ï¼š
  - AIæ¨¡å‹æ¨¡å— (`ai_model.py`) å·²åˆ›å»ºï¼Œå®ç°äº†AIæ¨¡å‹çš„è®­ç»ƒã€é¢„æµ‹å’Œç®¡ç†ã€‚
  - `tasks.py` ä¸­å·²æ‰©å±•äº†AIç›¸å…³çš„Celeryä»»åŠ¡ (`train_ai_model`, `run_prediction`, `batch_prediction`)ã€‚
  - `config.yml` å·²æ›´æ–°ï¼ŒåŒ…å«äº† `full_test_config` é…ç½®èŠ‚ï¼Œç”¨äºå®šä¹‰å…¨æµç¨‹æµ‹è¯•çš„å‚æ•°ã€‚
  - å…¨æµç¨‹è°ƒåº¦ç³»ç»Ÿå·²æ„å»ºï¼ŒåŒ…æ‹¬ä¸»å·¥ä½œæµè°ƒåº¦è„šæœ¬ (`run_daily_workflow.py`) å’Œå…¨æµç¨‹å®æµ‹ç¼–æ’å™¨ (`scripts/full_test_v1_1_6.py`)ã€‚
  - AIæ¨¡å‹èƒ½åŠ›å·²å®ç°ï¼Œæ”¯æŒå¤šæ¨¡å‹è®­ç»ƒã€æ‰¹é‡é¢„æµ‹å’Œæ¨¡å‹æŒä¹…åŒ–ã€‚
  - ä»»åŠ¡è°ƒåº¦æ¶æ„å·²è®¾è®¡ï¼Œåˆ©ç”¨Celeryçš„ `group`ã€`chain` å’Œ `chord` åŠŸèƒ½è¿›è¡Œä»»åŠ¡ç¼–æ’ã€‚
  - æµ‹è¯•é…ç½®å·²å®šä¹‰ï¼Œå…è®¸çµæ´»è®¾ç½®æµ‹è¯•æ—¥æœŸèŒƒå›´å’Œè‚¡ç¥¨æ± ã€‚
  - å·¥ä½œæµé˜¶æ®µå·²åˆ’åˆ†ï¼ŒåŒ…æ‹¬æ•°æ®åŒæ­¥ã€å› å­è®¡ç®—ã€AIæ¨¡å‹è®­ç»ƒã€AIé¢„æµ‹å’Œæ•°æ®è´¨é‡æ£€æŸ¥ã€‚
  - è´¨é‡ä¿è¯ä½“ç³»å·²å»ºç«‹ï¼Œé€šè¿‡æ•°æ®è´¨é‡æ£€æŸ¥ç¡®ä¿ä»»åŠ¡æµæ‰§è¡Œä¸€è‡´æ€§ã€è¾“å…¥æ•°æ®å®Œæ•´æ€§ã€ä¸­é—´äº§å“è¦†ç›–ç‡å’Œæœ€ç»ˆæˆå“æ—¶æ•ˆæ€§ã€‚
  - ç›¸å…³å·¥å…·å’Œè„šæœ¬ï¼ˆå¦‚ `scripts/clear_database.py` ç”¨äºæ¸…ç©ºæ•°æ®åº“ï¼‰å·²åˆ›å»ºã€‚
  - æŠ€æœ¯ç‰¹æ€§åŒ…æ‹¬æ¨¡å—åŒ–è®¾è®¡ã€å¼‚æ­¥ä»»åŠ¡å¤„ç†ã€å¯æ‰©å±•æ€§ã€å®¹é”™æœºåˆ¶å’Œæ€§èƒ½ç›‘æ§ã€‚
  - éƒ¨ç½²å‡†å¤‡å·²å®Œæˆï¼Œæ”¯æŒDockeréƒ¨ç½²å’ŒCeleryåˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ã€‚
  - ä¸‹ä¸€æ­¥è®¡åˆ’æ˜¯è¿›è¡Œå…¨é¢çš„é›†æˆæµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

- **v1.1.6 å…¨æµç¨‹å®æµ‹è°ƒè¯•è®°å½•**ï¼š
  - **Celery Worker å¯åŠ¨é—®é¢˜**ï¼š
    - åˆå§‹é”™è¯¯ï¼š`ModuleNotFoundError: No module named 'utils'`
    - ä¿®å¤ï¼šä¿®æ”¹ `src/compute/tasks.py` ä¸­çš„å¯¼å…¥è¯­å¥ï¼Œå°†ç›¸å¯¹å¯¼å…¥æ”¹ä¸ºç»å¯¹å¯¼å…¥ï¼ˆä¾‹å¦‚ï¼š`from src.utils.db import get_db_engine`ï¼‰ã€‚
    - åˆå§‹é”™è¯¯ï¼š`ImportError: cannot import name 'TushareDataSync' from 'src.data.tushare_sync'`
    - ä¿®å¤ï¼šå°† `src/compute/tasks.py` ä¸­ `TushareDataSync` çš„å¯¼å…¥ä¿®æ”¹ä¸º `TushareSynchronizer`ï¼Œå› ä¸º `src/data/tushare_sync.py` ä¸­å®šä¹‰çš„ç±»åä¸º `TushareSynchronizer`ã€‚
    - åˆå§‹é”™è¯¯ï¼š`consumer: Cannot connect to redis://localhost:6379/0: Authentication required..`
    - ä¿®å¤ï¼šåœ¨ `src/compute/tasks.py` ä¸­ç¡¬ç¼–ç  Redis å¯†ç è¿›è¡Œæµ‹è¯•ï¼ˆ`redis://:redis123@localhost:6379/0`ï¼‰ï¼ŒéªŒè¯è¿æ¥æˆåŠŸåï¼Œæ”¹å›ä½¿ç”¨ç¯å¢ƒå˜é‡ `REDIS_URL`ã€‚
  - **`clear_database.py` è„šæœ¬è¿è¡Œé—®é¢˜**ï¼š
    - åˆå§‹é”™è¯¯ï¼š`ImportError: cannot import name 'ConfigLoader' from 'src.utils.config_loader'`
    - ä¿®å¤ï¼šå°† `scripts/clear_database.py` ä¸­çš„ `ConfigLoader` å¯¼å…¥ä¿®æ”¹ä¸º `Config`ï¼Œå› ä¸º `src/utils/config_loader.py` ä¸­å®šä¹‰çš„ç±»åä¸º `Config`ã€‚
    - åˆå§‹é”™è¯¯ï¼š`NameError: name 'ConfigLoader' is not defined`
    - ä¿®å¤ï¼šå°† `scripts/clear_database.py` ä¸­ `DatabaseCleaner` ç±»åˆå§‹åŒ–æ–¹æ³•ä¸­çš„ `ConfigLoader()` ä¿®æ”¹ä¸º `Config()`ã€‚
    - ä¿®å¤ï¼š`scripts/clear_database.py` ä¸­æ•°æ®åº“åˆ é™¤æ“ä½œçš„æ‰§è¡Œæ–¹å¼é—®é¢˜ï¼Œé€šè¿‡å¯¼å…¥ `sqlalchemy.text` å¹¶ä½¿ç”¨ `conn.execute(text(f"DELETE FROM {table_name}"))` è§£å†³äº† `Not an executable object` é”™è¯¯ã€‚
  - **`run_daily_workflow.py` è„šæœ¬è¿è¡Œé—®é¢˜**ï¼š
    - åˆå§‹é”™è¯¯ï¼š`NameError: name 'ConfigLoader' is not defined`
    - ä¿®å¤ï¼šå°† `run_daily_workflow.py` ä¸­æ‰€æœ‰ `ConfigLoader` çš„å¼•ç”¨ä¿®æ”¹ä¸º `Config`ã€‚
    - æ”¹è¿›ï¼šåœ¨ `run_daily_workflow.py` ä¸­æ·»åŠ  `load_dotenv()`ï¼Œç¡®ä¿è„šæœ¬èƒ½æ­£ç¡®åŠ è½½ `.env` æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡ã€‚
  - **è°ƒè¯•ç»“æœ**ï¼š
    - Celery worker æˆåŠŸå¯åŠ¨å¹¶è¿æ¥åˆ° Redisã€‚
    - `clear_database.py` è„šæœ¬æˆåŠŸè¿è¡Œï¼Œæ•°æ®åº“æ¸…ç©ºåŠŸèƒ½æ­£å¸¸ã€‚
    - `run_daily_workflow.py` è„šæœ¬æˆåŠŸå¯åŠ¨ç®€åŒ–å·¥ä½œæµ.

## v1.1.5 çœŸå®æ•°æ®æµ‹è¯•é˜¶æ®µ

### æµ‹è¯•ç¯å¢ƒé…ç½®
- âœ… **ç‹¬ç«‹æµ‹è¯•æ•°æ®åº“** - é…ç½®äº†ç‹¬ç«‹çš„PostgreSQLæµ‹è¯•æ•°æ®åº“æœåŠ¡ï¼ˆç«¯å£15433ï¼‰
- âœ… **Dockerå®¹å™¨åŒ–** - ä½¿ç”¨TimescaleDBé•œåƒï¼Œæ”¯æŒæ—¶é—´åºåˆ—æ•°æ®ä¼˜åŒ–
- âœ… **æ•°æ®åº“éš”ç¦»** - æµ‹è¯•æ•°æ®åº“ä¸ç”Ÿäº§æ•°æ®åº“å®Œå…¨éš”ç¦»ï¼Œç¡®ä¿æµ‹è¯•å®‰å…¨æ€§

### ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
- âœ… **æ•°æ®åº“è¿æ¥æµ‹è¯•** - éªŒè¯æµ‹è¯•æ•°æ®åº“è¿æ¥å’ŒåŸºæœ¬æ“ä½œ
- âœ… **æ•°æ®åº“éš”ç¦»æµ‹è¯•** - ç¡®ä¿æµ‹è¯•æ•°æ®ä¸ä¼šå½±å“ç”Ÿäº§ç¯å¢ƒ
- âœ… **å®Œæ•´æµæ°´çº¿æµ‹è¯•** - ä»æ•°æ®åŒæ­¥åˆ°å› å­è®¡ç®—çš„ç«¯åˆ°ç«¯æµ‹è¯•
- âœ… **é»„é‡‘æ•°æ®æ ¡éªŒ** - ä½¿ç”¨é¢„è®¾æ•°æ®éªŒè¯RSIç­‰æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ç²¾åº¦
- âœ… **å› å­è®¡ç®—ä¸€è‡´æ€§** - éªŒè¯ç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡ºçš„ä¸€è‡´æ€§
- âœ… **æ•°æ®è´¨é‡éªŒè¯** - æ£€æŸ¥è‚¡ç¥¨æ•°æ®çš„å®Œæ•´æ€§å’Œåˆç†æ€§

### æŠ€æœ¯æŒ‡æ ‡ä¿®å¤
- âœ… **RSIè®¡ç®—ä¿®å¤** - ä¿®æ­£äº†RSIè®¡ç®—å‡½æ•°çš„å¯¼å…¥è·¯å¾„å’Œè°ƒç”¨æ–¹å¼
- âœ… **MACDè®¡ç®—ä¼˜åŒ–** - ç»Ÿä¸€äº†MACDå‡½æ•°è¿”å›DataFrameæ ¼å¼
- âœ… **å¸ƒæ—å¸¦è®¡ç®—éªŒè¯** - ä¼˜åŒ–äº†å¸ƒæ—å¸¦åˆç†æ€§éªŒè¯é€»è¾‘

### æµ‹è¯•æ•°æ®ç®¡ç†
- âœ… **æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨** - åˆ›å»ºäº†`TestDatabaseManager`ç±»ç®¡ç†æµ‹è¯•æ•°æ®
- âœ… **æ•°æ®è´¨é‡ä¿è¯** - ç¡®ä¿ç”Ÿæˆçš„æµ‹è¯•æ•°æ®ç¬¦åˆé‡‘èæ•°æ®è§„èŒƒ
- âœ… **è‡ªåŠ¨åŒ–æ¸…ç†** - å®ç°æµ‹è¯•ç¯å¢ƒçš„è‡ªåŠ¨è®¾ç½®å’Œæ¸…ç†

### æ¶æ„å†³ç­–è®°å½•
- âœ… **ADRæ–‡æ¡£** - åˆ›å»ºäº†`docs/adr/001-choice-of-ml-model.md`è®°å½•LightGBMé€‰æ‹©å†³ç­–
- âœ… **æŠ€æœ¯é€‰å‹æ–‡æ¡£** - è¯¦ç»†è®°å½•äº†æœºå™¨å­¦ä¹ æ¨¡å‹é€‰æ‹©çš„æŠ€æœ¯è€ƒé‡

### æ€§èƒ½åˆ†æ
- âœ… **æ€§èƒ½å‰–æå·¥å…·** - ä¿®å¤äº†æ€§èƒ½å‰–æå·¥å…·çš„æ¨¡å—å¯¼å…¥é—®é¢˜
- âœ… **æ€§èƒ½æŠ¥å‘Šç”Ÿæˆ** - ç”Ÿæˆäº†è¯¦ç»†çš„æ€§èƒ½åˆ†ææŠ¥å‘Š
- âœ… **ç“¶é¢ˆè¯†åˆ«** - è¯†åˆ«äº†ç³»ç»Ÿä¸­çš„æ½œåœ¨æ€§èƒ½ç“¶é¢ˆ

### æµ‹è¯•ç»“æœ
```
============================= test session starts =============================
src/tests/test_integration_pipeline.py::test_database_connection PASSED  [ 16%]
src/tests/test_integration_pipeline.py::test_database_isolation PASSED   [ 33%]
src/tests/test_integration_pipeline.py::test_full_pipeline_for_sample_data PASSED [ 50%]
src/tests/test_integration_pipeline.py::test_factor_golden_data_validation PASSED [ 66%]
src/tests/test_integration_pipeline.py::test_factor_calculation_consistency PASSED [ 83%]
src/tests/test_integration_pipeline.py::test_data_quality_validation PASSED [100%]

============================== 6 passed in 1.70s ==============================
```

### æŠ€æœ¯æ”¹è¿›
- **æ¨¡å—å¯¼å…¥ä¼˜åŒ–** - ä¿®å¤äº†å¤šä¸ªæ¨¡å—çš„å¯¼å…¥è·¯å¾„é—®é¢˜
- **å‡½æ•°æ¥å£ç»Ÿä¸€** - ç»Ÿä¸€äº†æŠ€æœ¯æŒ‡æ ‡è®¡ç®—å‡½æ•°çš„æ¥å£è§„èŒƒ
- **é”™è¯¯å¤„ç†å¢å¼º** - æ”¹è¿›äº†æµ‹è¯•ä¸­çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ•è·
- **æ•°æ®éªŒè¯é€»è¾‘** - ä¼˜åŒ–äº†é‡‘èæ•°æ®çš„åˆç†æ€§éªŒè¯é€»è¾‘

---

---

## v1.1.6 å…¨æµç¨‹å®æµ‹é˜¶æ®µ





## v1.1.6 æ•°æ®åŒæ­¥é—®é¢˜è°ƒè¯•è®°å½• (2025-07-28)

### æ•°æ®åº“çŠ¶æ€åˆ†æ (2025-07-28 04:46)
é€šè¿‡`check_database_status.py`è„šæœ¬æ£€æŸ¥å‘ç°ï¼š

**æ•°æ®åº“ç°çŠ¶ï¼ˆä¿®å¤åï¼‰ï¼š**
- `stock_daily`è¡¨ï¼šå¤§å¹…å¢åŠ ï¼ŒåŒ…å«æœ€è¿‘30ä¸ªäº¤æ˜“æ—¥å®Œæ•´æ•°æ®
- æ•°æ®æ—¶é—´èŒƒå›´ï¼š2025-04-30 åˆ° 2025-07-25 (30ä¸ªäº¤æ˜“æ—¥)
- `trade_calendar`è¡¨ï¼š2,036æ¡è®°å½•ï¼Œ1,349ä¸ªäº¤æ˜“æ—¥ (2020-01-01 åˆ° 2025-07-28)
- `stock_basic`è¡¨ï¼š5,417æ¡è®°å½•ï¼Œæ´»è·ƒè‚¡ç¥¨5,417åª
- **å…³é”®å‘ç°ï¼šé€šè¿‡æ•°æ®ä¿®å¤è„šæœ¬æˆåŠŸå›å¡«äº†å†å²æ•°æ®ï¼Œ000001.SZä»29æ¡å¢åŠ åˆ°59æ¡è®°å½•**

### é—®é¢˜æ ¹æºåˆ†æ
1. **å†å²æ•°æ®ç¼ºå¤±çš„æ ¹æœ¬åŸå› **
   - `get_last_trade_date()`å‡½æ•°é€»è¾‘ï¼šå¦‚æœè¡¨ä¸ºç©ºè¿”å›ä¸€å¹´å‰æ—¥æœŸï¼Œå¦‚æœæœ‰æ•°æ®è¿”å›æœ€å¤§æ—¥æœŸ
   - å½“å‰è¿”å›20250725ï¼Œå¯¼è‡´åªä»æœ€è¿‘æ—¥æœŸå¼€å§‹åŒæ­¥
   - ç¼ºå°‘å†å²æ•°æ®å›å¡«æœºåˆ¶

2. **å½“æ—¥æ•°æ®ç¼ºå¤±åŸå› **
   - 2025-07-28æ˜¯äº¤æ˜“æ—¥ä½†æ•°æ®åº“ä¸­æ— æ­¤æ—¥æœŸæ•°æ®
   - å¯èƒ½åŸå› ï¼šTushare APIå½“æ—¥æ•°æ®å»¶è¿Ÿï¼Œæˆ–åŒæ­¥é€»è¾‘é—®é¢˜

3. **æ•°æ®åŒæ­¥ç­–ç•¥é—®é¢˜**
   - `update_daily_data`é™åˆ¶æœ€å¤šåŒæ­¥30å¤©
   - æ²¡æœ‰å†å²æ•°æ®åˆå§‹åŒ–æœºåˆ¶
   - ç¼ºå°‘æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

### é—®é¢˜æ’æŸ¥è¿‡ç¨‹

#### 1. æ´»è·ƒè‚¡ç¥¨æ•°é‡é—®é¢˜
- **é—®é¢˜ç°è±¡**: `check_data.py`æ˜¾ç¤ºæ´»è·ƒè‚¡ç¥¨æ•°é‡ä¸º0
- **æ ¹æœ¬åŸå› **: `sync_stock_basic`å‡½æ•°ä¸­`fields`å‚æ•°ç¼ºå°‘`list_status`å­—æ®µ
- **è§£å†³æ–¹æ¡ˆ**: 
  - åœ¨`pro.stock_basic`çš„`fields`å‚æ•°ä¸­æ·»åŠ `list_status`
  - åœ¨`stock_basic`è¡¨åˆ›å»ºè¯­å¥ä¸­æ·»åŠ `list_status`å­—æ®µ
  - é‡æ–°åŒæ­¥æ•°æ®åï¼Œæ´»è·ƒè‚¡ç¥¨æ•°é‡æ¢å¤ä¸º5417

#### 2. æ—¥å¿—è®°å½•é—®é¢˜
- **é—®é¢˜ç°è±¡**: `sync_stock_basic`å‡½æ•°æ‰§è¡Œå¤±è´¥ï¼Œé”™è¯¯`name 'logger' is not defined`
- **è§£å†³æ–¹æ¡ˆ**: åœ¨`src/data/tushare_sync.py`æ–‡ä»¶é¡¶éƒ¨æ·»åŠ `from loguru import logger`

#### 3. å†å²æ•°æ®ä¸è¶³é—®é¢˜
- **é—®é¢˜ç°è±¡**: `000001.SZ`åªæœ‰29æ¡æ•°æ®ï¼Œæ—¶é—´èŒƒå›´ä¸º2025-06-17åˆ°2025-07-25
- **æ ¹æœ¬åŸå› **: 
  - `get_last_trade_date()`è¿”å›æœ€æ–°æ—¥æœŸï¼Œå¯¼è‡´åªåšå¢é‡åŒæ­¥
  - ç¼ºå°‘å†å²æ•°æ®åˆå§‹åŒ–æœºåˆ¶
  - `update_daily_data`å‡½æ•°é™åˆ¶æœ€å¤šåŒæ­¥30å¤©

#### 4. å½“æ—¥æ•°æ®ç¼ºå¤±é—®é¢˜
- **å½“å‰æ—¥æœŸ**: 2025-07-28 (å‘¨ä¸€ï¼Œç¡®è®¤ä¸ºäº¤æ˜“æ—¥)
- **æ•°æ®åº“æœ€æ–°**: 2025-07-25 (å‘¨äº”)
- **ç¼ºå¤±æ—¥æœŸ**: 2025-07-28å½“æ—¥æ•°æ®
- **å¯èƒ½åŸå› **: Tushare APIæ•°æ®å»¶è¿Ÿæˆ–åŒæ­¥é€»è¾‘é—®é¢˜

### å·²è§£å†³é—®é¢˜
- âœ… æ´»è·ƒè‚¡ç¥¨æ•°é‡ä¸º0 â†’ ä¿®å¤`list_status`å­—æ®µåŒæ­¥
- âœ… æ—¥å¿—è®°å½•ç¼ºå¤± â†’ æ·»åŠ `logger`å¯¼å…¥
- âœ… æ•°æ®åº“è¿æ¥é—®é¢˜ â†’ ç¡®è®¤ä½¿ç”¨ç«¯å£15432æ­£å¸¸è¿æ¥
- âœ… **å†å²æ•°æ®ç¼ºå¤±** â†’ é€šè¿‡`fix_data_sync.py`è„šæœ¬æˆåŠŸå›å¡«æœ€è¿‘30ä¸ªäº¤æ˜“æ—¥æ•°æ®
- âœ… **æ•°æ®ä¿®å¤æœºåˆ¶** â†’ åˆ›å»ºä¸“é—¨çš„æ•°æ®ä¿®å¤è„šæœ¬ï¼Œæ”¯æŒæ‰¹é‡å†å²æ•°æ®åŒæ­¥

### æ•°æ®ä¿®å¤æˆæœ
- **ä¿®å¤è„šæœ¬**: `fix_data_sync.py`
- **å›å¡«èŒƒå›´**: 2025-04-30 åˆ° 2025-06-16 (30ä¸ªäº¤æ˜“æ—¥)
- **æ•°æ®å¢é‡**: 000001.SZä»29æ¡å¢åŠ åˆ°59æ¡è®°å½•
- **åŒæ­¥æ•ˆæœ**: æ¯ä¸ªäº¤æ˜“æ—¥çº¦5,400æ¡è‚¡ç¥¨è®°å½•

### å¾…è§£å†³é—®é¢˜
- âŒ **å½“æ—¥æ•°æ®ç¼ºå¤±**ï¼š2025-07-28äº¤æ˜“æ—¥Tushareæš‚æ— æ•°æ®ï¼ˆæ­£å¸¸æƒ…å†µï¼Œç­‰å¾…æ•°æ®å‘å¸ƒï¼‰
- âŒ **æ›´é•¿å†å²æ•°æ®**ï¼šå¦‚éœ€è¦æ›´æ—©æœŸæ•°æ®ï¼Œå¯æ‰©å±•è„šæœ¬åŒæ­¥èŒƒå›´

### ä¸‹ä¸€æ­¥è®¡åˆ’
1. ç›‘æ§å½“æ—¥æ•°æ®å‘å¸ƒæƒ…å†µ
2. æ ¹æ®éœ€è¦æ‰©å±•å†å²æ•°æ®èŒƒå›´
3. å°†æ•°æ®ä¿®å¤è„šæœ¬é›†æˆåˆ°å®šæœŸç»´æŠ¤æµç¨‹
4. ä¼˜åŒ–æ•°æ®åŒæ­¥çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

## v1.1.6 è°ƒè¯•å·¥å…·æ•´åˆ (2025-07-28)

### è°ƒè¯•å·¥å…·æ•´åˆ
- âœ… **è°ƒè¯•å·¥å…·è¿ç§»** - å°†æ‰€æœ‰è°ƒè¯•è„šæœ¬ç§»åŠ¨åˆ°`test/`ç›®å½•
  - `check_database_status.py` - æ•°æ®åº“çŠ¶æ€æ£€æŸ¥
  - `check_data.py` - æ•°æ®éªŒè¯
  - `fix_data_sync.py` - æ•°æ®ä¿®å¤å’Œå›å¡«
- âœ… **ä¸´æ—¶æ–‡ä»¶æ¸…ç†** - åˆ é™¤å¼€å‘è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶
- âœ… **æ•°æ®åº“ç«¯å£æ£€æŸ¥** - å‘ç°å¹¶å‡†å¤‡ä¿®å¤15433ç«¯å£ç›¸å…³ä»£ç 

### å‘ç°çš„é—®é¢˜
- âš ï¸ **æµ‹è¯•æ•°æ®åº“ç«¯å£** - å‘ç°ä»¥ä¸‹æ–‡ä»¶ä¸­ä½¿ç”¨15433ç«¯å£:
  - `src/utils/test_db.py` - æµ‹è¯•æ•°æ®åº“è¿æ¥é…ç½®
  - `src/tests/test_integration_pipeline.py` - é›†æˆæµ‹è¯•ä¸­çš„ç«¯å£éªŒè¯
  - `docker-compose.yml` - test_dbæœåŠ¡ç«¯å£æ˜ å°„
  - `log.md` - æ–‡æ¡£ä¸­çš„ç«¯å£è¯´æ˜

### å·²å®Œæˆäº‹é¡¹
- âœ… **è°ƒè¯•åŠŸèƒ½é›†æˆ** - å°†1.16è°ƒè¯•.mdä¸­çš„è¿ç»´æŒ‡ä»¤å®Œæ•´é›†æˆåˆ°run.pyï¼Œå¹¶é€šè¿‡â€œé£è¡Œå‰æ£€æŸ¥â€éªŒè¯ä¿®å¤æˆåŠŸã€‚
  - é£è¡Œå‰æ£€æŸ¥ (Pre-Flight Check) - ç¯å¢ƒå¥åº·æ£€æŸ¥
  - Celery Workerå¯åŠ¨å’Œç›‘æ§
  - æ—¥å¸¸å·¥ä½œæµæ‰§è¡Œ
  - æ•°æ®è´¨é‡æ£€éªŒ
  - æ•°æ®ä¿®å¤å’Œå›å¡«
  - ç´§æ€¥æƒ…å†µè¯Šæ–­
- âœ… **è¿ç»´æ§åˆ¶å°** - åˆ›å»ºäº†å®Œæ•´çš„è¿ç»´å’Œè°ƒè¯•æ§åˆ¶å°ç•Œé¢
- âœ… **åŠŸèƒ½æµ‹è¯•** - åˆ›å»ºå¹¶é€šè¿‡äº†run.pyè¿ç»´åŠŸèƒ½çš„å®Œæ•´æµ‹è¯•

### å¾…å¤„ç†äº‹é¡¹
- ğŸ”„ **ç«¯å£é…ç½®ç»Ÿä¸€** - ç”¨æˆ·å°†åˆ é™¤15433æ•°æ®åº“ï¼Œéœ€è¦æ›´æ–°ç›¸å…³ä»£ç 
  - `src/utils/test_db.py` - æµ‹è¯•æ•°æ®åº“è¿æ¥é…ç½®
  - `src/tests/test_integration_pipeline.py` - é›†æˆæµ‹è¯•ä¸­çš„ç«¯å£éªŒè¯
  - `docker-compose.yml` - test_dbæœåŠ¡ç«¯å£æ˜ å°„
  - ç›¸å…³æ–‡æ¡£æ›´æ–°

---

## ç¡¬ç¼–ç å‚æ•°é…ç½®åŒ–ä¿®æ”¹æ—¥å¿—

## ä¿®æ”¹æ¦‚è¿°
æœ¬æ¬¡ä¿®æ”¹å°†é¡¹ç›®ä¸­çš„ç¡¬ç¼–ç å‚æ•°æ›¿æ¢ä¸ºä»é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯é…ç½®æ€§å’Œçµæ´»æ€§ã€‚

## ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨

### 1. src/data/tushare_sync.py
**ä¿®æ”¹å†…å®¹ï¼š**
- `batch_size` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1000` æ”¹ä¸ºä»é…ç½® `data_sync_params.batch_size` åŠ è½½
- `sleep_time` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1` æ”¹ä¸ºä»é…ç½® `data_sync_params.sleep_time` åŠ è½½
- `max_retries` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `3` æ”¹ä¸ºä»é…ç½® `data_sync_params.max_retries` åŠ è½½
- `chunk_size` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `10000` æ”¹ä¸ºä»é…ç½® `data_sync_params.chunk_size` åŠ è½½

### 2. src/compute/factor_engine.py
**ä¿®æ”¹å†…å®¹ï¼š**
- `batch_size` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1000` æ”¹ä¸ºä»é…ç½® `compute_params.batch_size` åŠ è½½
- `max_workers` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `4` æ”¹ä¸ºä»é…ç½® `compute_params.max_workers` åŠ è½½
- `chunk_size` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `5000` æ”¹ä¸ºä»é…ç½® `compute_params.chunk_size` åŠ è½½

### 3. src/compute/quality.py
**ä¿®æ”¹å†…å®¹ï¼š**
- `sample_size` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1000` æ”¹ä¸ºä»é…ç½® `quality_params.sample_size` åŠ è½½
- `threshold` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `0.95` æ”¹ä¸ºä»é…ç½® `quality_params.threshold` åŠ è½½
- `max_gap_days` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `7` æ”¹ä¸ºä»é…ç½® `quality_params.max_gap_days` åŠ è½½
- `outlier_threshold` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `3` æ”¹ä¸ºä»é…ç½® `quality_params.outlier_threshold` åŠ è½½
- `min_data_points` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `30` æ”¹ä¸ºä»é…ç½® `quality_params.min_data_points` åŠ è½½

### 4. src/features/feature_store.py
**ä¿®æ”¹å†…å®¹ï¼š**
- `batch_size` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1000` æ”¹ä¸ºä»é…ç½® `feature_params.batch_size` åŠ è½½
- `cache_size` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `10000` æ”¹ä¸ºä»é…ç½® `feature_params.cache_size` åŠ è½½
- `max_workers` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `4` æ”¹ä¸ºä»é…ç½® `feature_params.max_workers` åŠ è½½
- `chunk_size` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `5000` æ”¹ä¸ºä»é…ç½® `feature_params.chunk_size` åŠ è½½
- `top_n` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `20` æ”¹ä¸ºä»é…ç½® `feature_params.top_n` åŠ è½½

### 5. src/monitoring/alerts.py
**ä¿®æ”¹å†…å®¹ï¼š**
- `max_history` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1000` æ”¹ä¸ºä»é…ç½® `monitoring_params.max_history` åŠ è½½
- `timeout` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `30` æ”¹ä¸ºä»é…ç½® `monitoring_params.webhook_timeout` åŠ è½½
- `alert_check_limit` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1000` æ”¹ä¸ºä»é…ç½® `monitoring_params.alert_check_limit` åŠ è½½
- `stats_limit` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1000` æ”¹ä¸ºä»é…ç½® `monitoring_params.stats_limit` åŠ è½½

### 6. src/monitoring/performance.py
**ä¿®æ”¹å†…å®¹ï¼š**
- `collection_interval` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `60` æ”¹ä¸ºä»é…ç½® `monitoring_params.collection_interval` åŠ è½½
- `metrics_max_history` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1000` æ”¹ä¸ºä»é…ç½® `monitoring_params.metrics_max_history` åŠ è½½
- `metric_window_minutes` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `60` æ”¹ä¸ºä»é…ç½® `monitoring_params.metric_window_minutes` åŠ è½½
- `separator_length` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `100` æ”¹ä¸ºä»é…ç½® `monitoring_params.separator_length` åŠ è½½
- `slow_query_threshold` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1.0` æ”¹ä¸ºä»é…ç½® `monitoring_params.slow_query_threshold` åŠ è½½
- `save_interval` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `300` æ”¹ä¸ºä»é…ç½® `monitoring_params.save_interval` åŠ è½½
- `thread_join_timeout` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `5` æ”¹ä¸ºä»é…ç½® `monitoring_params.thread_join_timeout` åŠ è½½
- `slow_query_limit` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `20` æ”¹ä¸ºä»é…ç½® `monitoring_params.slow_query_limit` åŠ è½½
- `slow_query_threshold_check` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `10` æ”¹ä¸ºä»é…ç½® `monitoring_params.slow_query_threshold_check` åŠ è½½
- `data_retention_days` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `30` æ”¹ä¸ºä»é…ç½® `monitoring_params.data_retention_days` åŠ è½½

### 7. src/strategy/evaluation.py
**ä¿®æ”¹å†…å®¹ï¼š**
- `rolling_window` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `60` æ”¹ä¸ºä»é…ç½® `strategy_params.rolling_window` åŠ è½½

### 8. src/strategy/model_explainer.py
**ä¿®æ”¹å†…å®¹ï¼š**
- `shap_sample_size` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `1000` æ”¹ä¸ºä»é…ç½® `strategy_params.shap_sample_size` åŠ è½½
- `max_features_display` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `15` æ”¹ä¸ºä»é…ç½® `strategy_params.max_features_display` åŠ è½½
- `top_features_count` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `10` æ”¹ä¸ºä»é…ç½® `strategy_params.top_features_count` åŠ è½½

### 9. src/utils/retry.py
**ä¿®æ”¹å†…å®¹ï¼š**
- `max_retries` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `3` æ”¹ä¸ºä»é…ç½® `utils_params.max_retries` åŠ è½½
- `retry_sleep_base` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `2` æ”¹ä¸ºä»é…ç½® `utils_params.retry_sleep_base` åŠ è½½

### 10. src/api/main.py
**ä¿®æ”¹å†…å®¹ï¼š**
- `host` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `"0.0.0.0"` æ”¹ä¸ºä»é…ç½® `api_params.host` åŠ è½½
- `port` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `8000` æ”¹ä¸ºä»é…ç½® `api_params.port` åŠ è½½
- `reload` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `True` æ”¹ä¸ºä»é…ç½® `api_params.reload` åŠ è½½
- `log_level` é»˜è®¤å€¼ä»ç¡¬ç¼–ç  `"info"` æ”¹ä¸ºä»é…ç½® `api_params.log_level` åŠ è½½

## é…ç½®å‚æ•°è¯´æ˜

### éœ€è¦åœ¨config.yamlä¸­æ·»åŠ çš„æ–°é…ç½®é¡¹ï¼š

```yaml
# APIå‚æ•°
api_params:
  host: "0.0.0.0"
  port: 8000
  reload: true
  log_level: "info"
  default_limit: 100
  min_limit: 1
  max_limit: 1000

# å·¥å…·å‚æ•°
utils_params:
  max_retries: 3
  retry_sleep_base: 2

# ç›‘æ§å‚æ•°
monitoring_params:
  max_history: 1000
  webhook_timeout: 30
  alert_check_limit: 1000
  stats_limit: 1000
  collection_interval: 60
  metrics_max_history: 1000
  metric_window_minutes: 60
  separator_length: 100
  slow_query_threshold: 1.0
  save_interval: 300
  thread_join_timeout: 5
  slow_query_limit: 20
  slow_query_threshold_check: 10
  data_retention_days: 30

# ç­–ç•¥å‚æ•°æ‰©å±•
strategy_params:
  rolling_window: 60
  shap_sample_size: 1000
  max_features_display: 15
  top_features_count: 10

# ç‰¹å¾å‚æ•°
feature_params:
  batch_size: 1000
  cache_size: 10000
  max_workers: 4
  chunk_size: 5000
  top_n: 20

# è´¨é‡æ£€æŸ¥å‚æ•°
quality_params:
  sample_size: 1000
  threshold: 0.95
  max_gap_days: 7
  outlier_threshold: 3
  min_data_points: 30

# è®¡ç®—å‚æ•°
compute_params:
  batch_size: 1000
  max_workers: 4
  chunk_size: 5000

# æ•°æ®åŒæ­¥å‚æ•°æ‰©å±•
data_sync_params:
  batch_size: 1000
  sleep_time: 1
  max_retries: 3
  chunk_size: 10000
```

## ä¿®æ”¹æ•ˆæœ

1. **æé«˜å¯é…ç½®æ€§**ï¼šæ‰€æœ‰å…³é”®å‚æ•°éƒ½å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œè°ƒæ•´ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
2. **ä¾¿äºç¯å¢ƒé€‚é…**ï¼šä¸åŒç¯å¢ƒå¯ä»¥ä½¿ç”¨ä¸åŒçš„é…ç½®å‚æ•°
3. **æå‡ç»´æŠ¤æ€§**ï¼šå‚æ•°é›†ä¸­ç®¡ç†ï¼Œä¾¿äºç»Ÿä¸€è°ƒæ•´å’Œç»´æŠ¤
4. **å¢å¼ºçµæ´»æ€§**ï¼šå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åŠ¨æ€è°ƒæ•´ç³»ç»Ÿè¡Œä¸º

## æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰ä¿®æ”¹éƒ½ä¿æŒäº†å‘åå…¼å®¹æ€§ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰ç›¸åº”å‚æ•°ï¼Œä¼šä½¿ç”¨åŸæ¥çš„é»˜è®¤å€¼
2. å»ºè®®åœ¨éƒ¨ç½²å‰æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…è¦çš„å‚æ•°
3. éƒ¨åˆ†å‚æ•°ï¼ˆå¦‚æ‰¹å¤„ç†å¤§å°ã€çº¿ç¨‹æ•°ç­‰ï¼‰çš„è°ƒæ•´å¯èƒ½ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œå»ºè®®æ ¹æ®å®é™…ç¯å¢ƒè¿›è¡Œæµ‹è¯•å’Œè°ƒä¼˜


## Celeryä»»åŠ¡è¿›åº¦æ˜¾ç¤ºä¼˜åŒ–

1. **ä¿®æ”¹æ–‡ä»¶**: `src/compute/tasks.py`
   - åœ¨ `sync_daily_data` ä»»åŠ¡ä¸­æ·»åŠ è¿›åº¦æ›´æ–°ï¼Œé€šè¿‡ `self.update_state` æ–¹æ³•æŠ¥å‘Šå½“å‰æ­£åœ¨åŒæ­¥çš„æ•°æ®ç±»å‹ï¼ˆå¦‚"åŒæ­¥åŸºç¡€æ•°æ®"å’Œ"åŒæ­¥äº¤æ˜“æ•°æ®"ï¼‰
   - åœ¨ `calculate_daily_factors` ä»»åŠ¡ä¸­æ·»åŠ è¿›åº¦æ›´æ–°ï¼ŒæŠ¥å‘Šå½“å‰æ­£åœ¨è®¡ç®—çš„è‚¡ç¥¨æ•°é‡å’Œæ€»è¿›åº¦

2. **ä¿®æ”¹æ–‡ä»¶**: `run_daily_workflow.py`
   - é‡æ„ `run_full_workflow` å‡½æ•°ï¼Œå°†ä»»åŠ¡é“¾æ‹†åˆ†ä¸ºäº”ä¸ªç‹¬ç«‹é˜¶æ®µï¼ˆæ•°æ®åŒæ­¥ã€å› å­è®¡ç®—ã€AIè®­ç»ƒã€æ‰¹é‡é¢„æµ‹ã€è´¨é‡æ£€æŸ¥ï¼‰
   - ä¸ºæ¯ä¸ªé˜¶æ®µæ·»åŠ ç‹¬ç«‹çš„è¿›åº¦ç›‘æ§é€»è¾‘
   - æ•°æ®åŒæ­¥å’Œå› å­è®¡ç®—ä»»åŠ¡ç»„ç°åœ¨ä¼šæ˜¾ç¤ºæ¯ä¸ªå­ä»»åŠ¡çš„è¯¦ç»†è¿›åº¦
   - æ·»åŠ è¶…æ—¶æœºåˆ¶ï¼ˆ2å°æ—¶ï¼‰

3. **æ–°å¢åŠŸèƒ½**:
   - æ•°æ®åŒæ­¥ä»»åŠ¡æ˜¾ç¤ºå½“å‰æ­¥éª¤å’Œè¿›åº¦ç™¾åˆ†æ¯”
   - å› å­è®¡ç®—ä»»åŠ¡æ˜¾ç¤ºå·²å¤„ç†è‚¡ç¥¨æ•°é‡ã€æ€»æ•°é‡å’Œå½“å‰è‚¡ç¥¨ä»£ç 
   - æ‰€æœ‰ä»»åŠ¡é˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„å¼€å§‹å’Œå®ŒæˆçŠ¶æ€æç¤º

4. **ä¿®å¤é—®é¢˜**:
   - ä¿®å¤ `AsyncResult` åˆå§‹åŒ–æ—¶ç¼ºå°‘ `app` å®ä¾‹çš„é—®é¢˜
   - æ·»åŠ ç¼ºå¤±çš„ `import time` è¯­å¥

è¿™äº›ä¿®æ”¹ä½¿å¾—åœ¨è¿è¡Œå®Œæ•´å·¥ä½œæµæ—¶ï¼Œæ§åˆ¶å°èƒ½å¤Ÿå®æ—¶æ˜¾ç¤ºæ›´è¯¦ç»†çš„è¿›åº¦ä¿¡æ¯ï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°äº†è§£ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ã€‚