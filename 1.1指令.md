### **《v1.1版 AI构建指令清单》**



**核心指令**:

> AI，我们现在进入StockSchool项目的核心功能开发阶段 (v1.1)。这个阶段的目标是打通从数据补全到AI模型产出的完整流水线。请严格按照以下三个阶段的指令执行，并在每个阶段完成后，等待我的质检确认。

------



#### **第一站：数据补全与入库 (指令)**



**【v1.1 指令 1/6】**

> **任务**: 完善`tushare_sync.py`，添加财务数据和指标数据的同步功能。
>
> **请修改文件 `stockschool/src/data/tushare_sync.py`**:
>
> 1. 在`TushareSynchronizer`类中，新增一个方法 `update_financial_data(self, stock_list, start_date)`。该方法应循环获取指定股票列表从指定开始日期至今的所有**利润表、资产负债表、现金流量表**数据，并使用`to_sql`的`if_exists='append'`模式存入`financial_reports`表中。
> 2. 新增一个方法 `update_daily_basic_data(self)`。该方法应获取所有股票**最新的每日指标数据**（包含PE、PB、总市值等），并存入`daily_basic`表中。采用覆盖式写入或基于`trade_date`的增量写入均可。
>
> **完成后，请告诉我“财务与指标数据同步功能已添加”。**

**【v1.1 指令 2/6】**

> **任务**: 创建`akshare_sync.py`，实现情绪数据的同步。
>
> **请创建新文件 `stockschool/src/data/akshare_sync.py`**:
>
> 1. 创建一个`AkshareSynchronizer`类。
> 2. 在类中实现一个方法 `update_sentiment_data(self)`。该方法应调用Akshare接口，获取**A股新闻情绪指数**或**个股用户关注指数**等情绪类数据。
> 3. 将获取到的数据进行处理，并存入一个新的数据表`market_sentiment`中（请先在`database_schema.sql`中添加此表的创建语句）。
>
> **完成后，请告诉我“情绪数据同步器已创建”。**

------



#### **第二站：核心因子计算 (指令)**



**【v1.1 指令 3/6】**

> **任务**: 升级`factor_engine.py`，使其能够计算基本面因子。
>
> **请修改文件 `stockschool/src/compute/factor_engine.py`**:
>
> 1. 修改`FactorEngine`的`run()`方法，使其增加一个新的步骤：计算基本面因子。
> 2. 新增一个私有方法 `_calculate_fundamental_factors(self)`。此方法应：
>    - 从`financial_reports`表中读取所需公司的财务数据。
>    - 调用`indicators.py`中的函数（你需要先在其中添加如**ROE、营收同比增长率(YOY)、净利润同比增长率**等基本面指标的计算函数）进行计算。
>    - 将计算出的因子结果，存入`factor_library`表中（同样，请先在`database_schema.sql`中添加此表的创建语句）。
>
> **完成后，请告诉我“基本面因子计算功能已集成”。**

**【v1.1 指令 4/6】**

> **任务**: 实现因子标准化与预处理模块。
>
> **请创建新文件 `stockschool/src/features/processing.py`**:
>
> 1. 创建一个`FeatureProcessor`类。
> 2. 实现一个核心方法 `process(self, factor_df)`。此方法接收一个包含多列原始因子的DataFrame，并执行以下流水线操作：
>    - 调用`quality.py`中的函数进行**去极值和缺失值填充**。
>    - 实现**Z-score标准化**。该标准化逻辑需要支持**全市场标准化**和**分行业标准化**两种模式，通过参数切换。
>
> **完成后，请告诉我“因子预处理器已创建”。**

------



#### **第三站：AI模型训练与预测 (指令)**



**【v1.1 指令 5/6】**

> **任务**: 创建完整的模型训练流水线脚本。
>
> **请创建新文件 `stockschool/src/strategy/training_pipeline.py`**:
>
> 1. 创建一个`TrainingPipeline`类。
> 2. 实现一个`run_training(self, start_date, end_date)`方法，该方法需要按顺序执行以下所有步骤：
>    - **数据准备**: 从数据库中获取指定时间段内的所有**已标准化的因子数据 (X)**。
>    - **标签生成**: 计算并获取对应的**未来N日收益率作为标签 (Y)**。
>    - **模型训练**: 使用`LightGBM`或`XGBoost`训练模型。
>    - **模型评估**: 调用`evaluation.py`中的函数，对模型在测试集上的表现进行评估，并打印报告。
>    - **模型保存**: 将训练好的模型（包括模型本身和特征列表）保存到本地文件（例如，使用`joblib`或`pickle`），文件名需包含版本和日期。
>
> **完成后，请告诉我“模型训练流水线已创建”。**

**【v1.1 指令 6/6】**

> **任务**: 创建每日预测脚本。
>
> **请创建新文件 `stockschool/src/strategy/prediction.py`**:
>
> 1. 创建一个`Predictor`类。
> 2. 实现一个`predict_daily(self)`方法，它执行以下操作：
>    - 加载**最新版本**的已训练模型。
>    - 获取**最新**的因子数据，并使用`FeatureProcessor`进行标准化。
>    - 使用加载的模型对最新的因子数据进行预测，得到每个股票的分数。
>    - 将带有预测分数的股票列表存入一个新的结果表`prediction_results`中，并按分数排序。
>
> **完成后，请告诉我“每日预测脚本已创建”。**