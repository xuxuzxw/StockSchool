# ADR-001: 选择LightGBM作为主要机器学习模型

## 状态
已接受

## 背景
StockSchool v1.1版本需要选择一个主要的机器学习模型来进行股票价格预测和因子建模。我们需要在多个候选模型中做出选择，包括传统的线性模型、集成学习模型以及梯度提升模型。

## 决策
我们选择LightGBM (Light Gradient Boosting Machine) 作为StockSchool的主要机器学习模型。

## 理由

### 1. 性能优势
- **训练速度快**: LightGBM使用基于直方图的算法，相比XGBoost训练速度提升10倍以上
- **内存占用低**: 相比其他GBDT实现，内存使用量减少约50%
- **准确性高**: 在大多数机器学习竞赛中表现优异，预测精度通常优于传统模型

### 2. 技术特性
- **叶子生长策略**: 采用leaf-wise生长策略，相比level-wise策略能更快收敛
- **特征并行**: 支持特征并行和数据并行，适合大规模数据处理
- **类别特征支持**: 原生支持类别特征，无需手动编码
- **过拟合控制**: 内置多种正则化机制，有效防止过拟合

### 3. 金融场景适用性
- **处理高维稀疏数据**: 金融因子数据通常具有高维稀疏特性，LightGBM能很好处理
- **非线性关系建模**: 能够捕捉因子间复杂的非线性关系
- **特征重要性**: 提供详细的特征重要性分析，便于因子筛选
- **增量学习**: 支持增量训练，适合金融数据的时序特性

### 4. 生态系统
- **Python集成**: 与pandas、numpy、scikit-learn无缝集成
- **文档完善**: 官方文档详细，社区活跃
- **工业级稳定性**: 被众多金融机构和科技公司采用
- **持续更新**: Microsoft维护，版本更新频繁

## 对比分析

### vs XGBoost
| 特性 | LightGBM | XGBoost |
|------|----------|----------|
| 训练速度 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 内存使用 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 准确性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 易用性 | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 生态系统 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

### vs 传统模型
- **线性回归**: LightGBM能捕捉非线性关系，预测能力更强
- **随机森林**: LightGBM训练速度更快，通常准确性更高
- **神经网络**: LightGBM更易调参，训练稳定性更好

## 实施策略

### 1. 模型配置
```python
lgb_params = {
    'objective': 'regression',
    'metric': 'rmse',
    'boosting_type': 'gbdt',
    'num_leaves': 31,
    'learning_rate': 0.05,
    'feature_fraction': 0.9,
    'bagging_fraction': 0.8,
    'bagging_freq': 5,
    'verbose': 0,
    'random_state': 42
}
```

### 2. 超参数优化
- 使用Optuna或GridSearchCV进行超参数调优
- 重点调优: num_leaves, learning_rate, feature_fraction
- 交叉验证确保模型泛化能力

### 3. 特征工程
- 利用LightGBM的特征重要性进行特征筛选
- 结合金融领域知识构建有效特征
- 定期评估和更新特征集

## 风险与缓解

### 1. 过拟合风险
- **风险**: 小数据集上容易过拟合
- **缓解**: 使用early_stopping, 调整正则化参数

### 2. 参数敏感性
- **风险**: 某些参数对结果影响较大
- **缓解**: 建立参数调优流程，定期重新调参

### 3. 黑盒模型
- **风险**: 模型可解释性相对较低
- **缓解**: 使用SHAP值分析，提供特征重要性报告

## 监控指标

### 1. 性能指标
- 训练时间 < 10分钟（标准数据集）
- 内存使用 < 4GB
- 预测准确性: RMSE, MAE, R²

### 2. 业务指标
- 因子预测准确率
- 策略收益率
- 最大回撤控制

## 替代方案

### 1. 短期替代
- XGBoost: 如果LightGBM出现问题，可快速切换
- 随机森林: 作为基准模型对比

### 2. 长期演进
- 深度学习模型: 考虑LSTM、Transformer等
- 集成模型: 多模型融合提升预测能力

## 决策时间线
- **2024-01**: 技术调研和对比分析
- **2024-02**: 原型开发和测试
- **2024-03**: 生产环境部署
- **2024-06**: 第一次性能评估
- **2024-12**: 年度模型评估和优化

## 相关文档
- [LightGBM官方文档](https://lightgbm.readthedocs.io/)
- [StockSchool模型训练指南](../model_training_guide.md)
- [因子工程最佳实践](../factor_engineering_best_practices.md)

## 变更历史
- 2024-01-15: 初始版本
- 2024-03-01: 添加实施细节
- 2024-06-01: 更新性能监控指标

---

**决策者**: StockSchool技术团队  
**审批者**: 架构师  
**生效日期**: 2024-01-15  
**下次评估**: 2024-12-31