# 2023-11-15 修改日志

## Celery任务进度显示优化

1. **修改文件**: `src/compute/tasks.py`
   - 在 `sync_daily_data` 任务中添加进度更新，通过 `self.update_state` 方法报告当前正在同步的数据类型（如"同步基础数据"和"同步交易数据"）
   - 在 `calculate_daily_factors` 任务中添加进度更新，报告当前正在计算的股票数量和总进度

2. **修改文件**: `run_daily_workflow.py`
   - 重构 `run_full_workflow` 函数，将任务链拆分为五个独立阶段（数据同步、因子计算、AI训练、批量预测、质量检查）
   - 为每个阶段添加独立的进度监控逻辑
   - 数据同步和因子计算任务组现在会显示每个子任务的详细进度
   - 添加超时机制（2小时）

3. **新增功能**:
   - 数据同步任务显示当前步骤和进度百分比
   - 因子计算任务显示已处理股票数量、总数量和当前股票代码
   - 所有任务阶段都有明确的开始和完成状态提示

4. **修复问题**:
   - 修复 `AsyncResult` 初始化时缺少 `app` 实例的问题
   - 添加缺失的 `import time` 语句

这些修改使得在运行完整工作流时，控制台能够实时显示更详细的进度信息，帮助用户更好地了解任务执行状态。