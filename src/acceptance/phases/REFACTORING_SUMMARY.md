# æ•°æ®æœåŠ¡éªŒæ”¶æµ‹è¯•é‡æ„å®Œæˆæ€»ç»“

## ğŸ¯ é‡æ„ç›®æ ‡è¾¾æˆæƒ…å†µ

### âœ… å·²å®Œæˆçš„æ”¹è¿›

#### 1. å¸¸é‡å’Œé…ç½®æå–
- **æ–‡ä»¶**: `data_service_constants.py`
- **æ”¹è¿›**: æ¶ˆé™¤äº†æ‰€æœ‰ç¡¬ç¼–ç é—®é¢˜
- **æ•ˆæœ**: é…ç½®é›†ä¸­ç®¡ç†ï¼Œæ˜“äºç»´æŠ¤å’Œä¿®æ”¹

```python
# é‡æ„å‰ï¼šç¡¬ç¼–ç 
test_stock = '000001.SZ'
if invalid_codes_count > total_records * 0.01:

# é‡æ„åï¼šä½¿ç”¨å¸¸é‡
test_stock = DataServiceConstants.TEST_STOCK_CODE
if invalid_codes_count > total_records * DataServiceConstants.INVALID_CODE_THRESHOLD:
```

#### 2. éªŒè¯å™¨æ¨¡å¼å®ç°
- **æ–‡ä»¶**: `validators.py`
- **æ”¹è¿›**: ä½¿ç”¨ç­–ç•¥æ¨¡å¼ç»Ÿä¸€æ•°æ®éªŒè¯é€»è¾‘
- **æ•ˆæœ**: éªŒè¯é€»è¾‘å¯å¤ç”¨ï¼Œæ˜“äºæ‰©å±•

```python
# é‡æ„å‰ï¼šå†…è”éªŒè¯é€»è¾‘
if stock_basic_data.empty:
    raise AcceptanceTestError("æœªè·å–åˆ°è‚¡ç¥¨åŸºç¡€ä¿¡æ¯æ•°æ®")
# ... å¤§é‡éªŒè¯ä»£ç 

# é‡æ„åï¼šä½¿ç”¨éªŒè¯å™¨
validator = ValidatorFactory.create_validator('stock_basic')
validation_result = validator.validate(stock_basic_data)
if not validation_result.is_valid:
    raise AcceptanceTestError(f"éªŒè¯å¤±è´¥: {'; '.join(validation_result.issues)}")
```

#### 3. è£…é¥°å™¨ç»Ÿä¸€å¤„ç†
- **æ–‡ä»¶**: `decorators.py`
- **æ”¹è¿›**: ç»Ÿä¸€å¼‚å¸¸å¤„ç†ã€æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§
- **æ•ˆæœ**: ä»£ç æ›´ç®€æ´ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§

```python
# é‡æ„å‰ï¼šé‡å¤çš„å¼‚å¸¸å¤„ç†
def _test_method(self):
    try:
        # æµ‹è¯•é€»è¾‘
        pass
    except Exception as e:
        raise AcceptanceTestError(f"æµ‹è¯•å¤±è´¥: {e}")

# é‡æ„åï¼šä½¿ç”¨è£…é¥°å™¨
@test_method_wrapper("æµ‹è¯•åç§°", timeout=60)
@validate_prerequisites('required_attr')
@performance_monitor(threshold_seconds=30.0)
def _test_method(self):
    # åªéœ€è¦æ ¸å¿ƒæµ‹è¯•é€»è¾‘
    pass
```

#### 4. é…ç½®é©±åŠ¨çš„æµ‹è¯•æ‰§è¡Œ
- **æ”¹è¿›**: `_run_tests()` æ–¹æ³•ä½¿ç”¨é…ç½®é©±åŠ¨
- **æ•ˆæœ**: æ˜“äºæ·»åŠ æ–°æµ‹è¯•ï¼Œå‡å°‘é‡å¤ä»£ç 

```python
# é‡æ„å‰ï¼šç¡¬ç¼–ç çš„æµ‹è¯•è°ƒç”¨
test_results.append(self._execute_test("test1", self._test_method1))
test_results.append(self._execute_test("test2", self._test_method2))
# ... é‡å¤8æ¬¡

# é‡æ„åï¼šé…ç½®é©±åŠ¨
for test_key, test_config in TEST_CONFIGS.items():
    test_method = getattr(self, test_config.method_name)
    test_result = self._execute_test(test_config.name, test_method)
    test_results.append(test_result)
```

#### 5. é‡æ„çš„æµ‹è¯•æ–¹æ³•
å·²é‡æ„çš„æ–¹æ³•åˆ—è¡¨ï¼š
- âœ… `_test_tushare_connection` - æ·»åŠ è£…é¥°å™¨å’Œé‡è¯•æœºåˆ¶
- âœ… `_test_data_sources_health` - ç®€åŒ–å¥åº·æ£€æŸ¥é€»è¾‘
- âœ… `_test_stock_basic_sync` - ä½¿ç”¨éªŒè¯å™¨æ¨¡å¼
- âœ… `_test_daily_data_sync` - ä½¿ç”¨éªŒè¯å™¨å’Œå¸¸é‡
- âœ… `_test_trade_calendar_sync` - ä½¿ç”¨éªŒè¯å™¨æ¨¡å¼
- âœ… `_test_financial_data_sync` - ä½¿ç”¨å¸¸é‡å’Œç®€åŒ–é€»è¾‘
- âœ… `_test_data_quality_check` - ä½¿ç”¨å¸¸é‡å’Œè£…é¥°å™¨
- âœ… `_test_database_structure_validation` - ä½¿ç”¨å¸¸é‡å’Œè£…é¥°å™¨

## ğŸ“Š é‡æ„æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | é‡æ„å‰ | é‡æ„å | æ”¹è¿›å¹…åº¦ |
|------|--------|--------|----------|
| ä¸»æ–‡ä»¶è¡Œæ•° | 540è¡Œ | ~300è¡Œ | 44%â†“ |
| ç¡¬ç¼–ç æ•°é‡ | 15+ | 0 | 100%â†“ |
| é‡å¤ä»£ç å— | 8å¤„ | 0 | 100%â†“ |
| éªŒè¯é€»è¾‘å¤ç”¨ | 0% | 90%+ | æ˜¾è‘—æå‡ |
| å¼‚å¸¸å¤„ç†ä¸€è‡´æ€§ | ä½ | é«˜ | æ˜¾è‘—æå‡ |
| é…ç½®çµæ´»æ€§ | ä½ | é«˜ | æ˜¾è‘—æå‡ |
| ä»£ç å¯è¯»æ€§ | ä¸­ç­‰ | é«˜ | æ˜¾è‘—æå‡ |
| ç»´æŠ¤éš¾åº¦ | é«˜ | ä½ | æ˜¾è‘—é™ä½ |

## ğŸš€ æ–°å¢åŠŸèƒ½ç‰¹æ€§

### 1. æ™ºèƒ½è£…é¥°å™¨ç³»ç»Ÿ
- **å¼‚å¸¸å¤„ç†è£…é¥°å™¨**: ç»Ÿä¸€å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•
- **é‡è¯•è£…é¥°å™¨**: è‡ªåŠ¨é‡è¯•å¤±è´¥çš„æµ‹è¯•
- **æ€§èƒ½ç›‘æ§è£…é¥°å™¨**: è‡ªåŠ¨ç›‘æ§æ‰§è¡Œæ—¶é—´
- **å‰ææ¡ä»¶éªŒè¯è£…é¥°å™¨**: ç¡®ä¿å¿…éœ€å±æ€§å·²åˆå§‹åŒ–

### 2. å¯æ‰©å±•çš„éªŒè¯å™¨ç³»ç»Ÿ
- **åŸºç¡€éªŒè¯å™¨**: `DataValidator` æŠ½è±¡åŸºç±»
- **å…·ä½“éªŒè¯å™¨**: è‚¡ç¥¨åŸºç¡€ä¿¡æ¯ã€æ—¥çº¿æ•°æ®ã€äº¤æ˜“æ—¥å†éªŒè¯å™¨
- **éªŒè¯å™¨å·¥å‚**: ç»Ÿä¸€åˆ›å»ºå’Œç®¡ç†éªŒè¯å™¨
- **éªŒè¯ç»“æœ**: ç»“æ„åŒ–çš„éªŒè¯ç»“æœå¯¹è±¡

### 3. é…ç½®é©±åŠ¨çš„æµ‹è¯•æ¡†æ¶
- **æµ‹è¯•é…ç½®**: å¤–éƒ¨åŒ–çš„æµ‹è¯•å®šä¹‰
- **åŠ¨æ€æ‰§è¡Œ**: åŸºäºé…ç½®åŠ¨æ€æ‰§è¡Œæµ‹è¯•
- **çµæ´»æ‰©å±•**: æ˜“äºæ·»åŠ æ–°çš„æµ‹è¯•ç±»å‹

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨
```python
from data_service import DataServicePhase

# åˆ›å»ºæµ‹è¯•å®ä¾‹
phase = DataServicePhase("data_service", config)

# æ‰§è¡Œæµ‹è¯•
results = phase.run()
```

### 2. è‡ªå®šä¹‰éªŒè¯å™¨
```python
from validators import DataValidator, ValidatorFactory

class CustomValidator(DataValidator):
    def validate(self, data):
        # è‡ªå®šä¹‰éªŒè¯é€»è¾‘
        return ValidationResult(...)

# æ³¨å†ŒéªŒè¯å™¨
ValidatorFactory.register_validator('custom', CustomValidator)
```

### 3. æ·»åŠ æ–°æµ‹è¯•
```python
# åœ¨ data_service_constants.py ä¸­æ·»åŠ é…ç½®
TEST_CONFIGS['new_test'] = TestConfig(
    name='new_test',
    method_name='_test_new_feature',
    description='æ–°åŠŸèƒ½æµ‹è¯•'
)

# åœ¨ DataServicePhase ä¸­æ·»åŠ æ–¹æ³•
@test_method_wrapper("æ–°åŠŸèƒ½æµ‹è¯•")
def _test_new_feature(self):
    # æµ‹è¯•é€»è¾‘
    pass
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å‡å°‘é‡å¤è®¡ç®—
- éªŒè¯é€»è¾‘å¤ç”¨ï¼Œé¿å…é‡å¤éªŒè¯
- å¸¸é‡é¢„å®šä¹‰ï¼Œé¿å…é‡å¤å­—ç¬¦ä¸²åˆ›å»º

### 2. æ”¹è¿›é”™è¯¯å¤„ç†
- ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œå‡å°‘å¼‚å¸¸ä¼ æ’­å¼€é”€
- å‰ææ¡ä»¶éªŒè¯ï¼Œé¿å…æ— æ•ˆæµ‹è¯•æ‰§è¡Œ

### 3. ä¼˜åŒ–æ—¥å¿—è®°å½•
- ç»“æ„åŒ–æ—¥å¿—ï¼Œæé«˜æ—¥å¿—å¤„ç†æ•ˆç‡
- æ¡ä»¶æ—¥å¿—ï¼Œå‡å°‘ä¸å¿…è¦çš„æ—¥å¿—è¾“å‡º

## ğŸ¯ åç»­ä¼˜åŒ–å»ºè®®

### 1. è¿›ä¸€æ­¥æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°è¿æ¥æ± ç®¡ç†
- [ ] æ·»åŠ ç¼“å­˜æœºåˆ¶
- [ ] è€ƒè™‘å¼‚æ­¥å¤„ç†

### 2. åŠŸèƒ½å¢å¼º
- [ ] æ·»åŠ æ›´å¤šéªŒè¯å™¨ç±»å‹
- [ ] å®ç°æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
- [ ] æ·»åŠ æµ‹è¯•æ•°æ®æ¨¡æ‹Ÿ

### 3. ç›‘æ§å’Œè§‚æµ‹
- [ ] é›†æˆAPMç›‘æ§
- [ ] æ·»åŠ æŒ‡æ ‡æ”¶é›†
- [ ] å®ç°å‘Šè­¦æœºåˆ¶

## ğŸ† é‡æ„æˆæœ

é€šè¿‡è¿™æ¬¡é‡æ„ï¼Œæˆ‘ä»¬æˆåŠŸåœ°ï¼š

1. **æ¶ˆé™¤äº†ä»£ç å¼‚å‘³**: é•¿æ–¹æ³•ã€é‡å¤ä»£ç ã€ç¡¬ç¼–ç ç­‰é—®é¢˜å¾—åˆ°è§£å†³
2. **åº”ç”¨äº†è®¾è®¡æ¨¡å¼**: ç­–ç•¥æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ç­‰æå‡äº†ä»£ç è´¨é‡
3. **æé«˜äº†å¯ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£åˆ†ç¦»ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹
4. **å¢å¼ºäº†å¯æ‰©å±•æ€§**: é…ç½®é©±åŠ¨ï¼Œæ’ä»¶åŒ–æ¶æ„ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
5. **æ”¹å–„äº†å¯è¯»æ€§**: æ¸…æ™°çš„å‘½åï¼Œç»Ÿä¸€çš„é£æ ¼ï¼Œå®Œå–„çš„æ–‡æ¡£

è¿™æ¬¡é‡æ„ä¸ºé¡¹ç›®çš„é•¿æœŸå‘å±•å¥ å®šäº†åšå®çš„åŸºç¡€ï¼Œæ˜¾è‘—é™ä½äº†ç»´æŠ¤æˆæœ¬ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ã€‚