#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ•°æ®åŒæ­¥åŠŸèƒ½æ¼”ç¤ºè„šæœ¬

æ¼”ç¤ºStockSchoolæ•°æ®åŒæ­¥å¢å¼ºåŠŸèƒ½çš„æ ¸å¿ƒç‰¹æ€§ï¼š
1. Akshareæ•°æ®æºé›†æˆ
2. ç”³ä¸‡è¡Œä¸šåˆ†ç±»ç®¡ç†
3. æ™ºèƒ½å¢é‡æ›´æ–°å¼•æ“
4. ç»Ÿä¸€æ•°æ®åŒæ­¥ç®¡ç†

ä½œè€…: StockSchool Team
åˆ›å»ºæ—¶é—´: 2025-01-03
"""

import sys
import os
import time
from datetime import datetime, timedelta

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°è·¯å¾„
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from src.data.akshare_sync import AkshareSynchronizer
from src.data.industry_classification import IndustryClassificationManager
from src.data.incremental_update import IncrementalUpdateManager, SyncPriority
from src.data.sync_manager import DataSyncManager


def demo_akshare_sync():
    """æ¼”ç¤ºAkshareæ•°æ®åŒæ­¥åŠŸèƒ½"""
    print("=" * 60)
    print("ğŸš€ æ¼”ç¤º Akshare æ•°æ®åŒæ­¥åŠŸèƒ½")
    print("=" * 60)
    
    try:
        # åˆ›å»ºAkshareåŒæ­¥å™¨
        syncer = AkshareSynchronizer()
        
        # æ¼”ç¤ºæ–°é—»æƒ…ç»ªæ•°æ®åŒæ­¥
        print("\nğŸ“° 1. æ–°é—»æƒ…ç»ªæ•°æ®åŒæ­¥æ¼”ç¤º")
        print("-" * 40)
        
        # è®¾ç½®æ—¥æœŸèŒƒå›´ï¼ˆæœ€è¿‘3å¤©ï¼‰
        end_date = datetime.now().strftime('%Y-%m-%d')
        start_date = (datetime.now() - timedelta(days=3)).strftime('%Y-%m-%d')
        
        print(f"åŒæ­¥æ—¥æœŸèŒƒå›´: {start_date} åˆ° {end_date}")
        
        # æ¨¡æ‹ŸåŒæ­¥ï¼ˆå®é™…ç¯å¢ƒä¸­ä¼šè°ƒç”¨çœŸå®APIï¼‰
        print("æ­£åœ¨åŒæ­¥æ–°é—»æƒ…ç»ªæ•°æ®...")
        time.sleep(1)  # æ¨¡æ‹ŸåŒæ­¥æ—¶é—´
        
        print("âœ… æ–°é—»æƒ…ç»ªæ•°æ®åŒæ­¥å®Œæˆ")
        print("   - å¤„ç†è‚¡ç¥¨æ•°é‡: 100")
        print("   - æ–°é—»æ•°æ®æ¡æ•°: 1,250")
        print("   - æƒ…ç»ªåˆ†æç»“æœ: æ­£é¢ 45%, ä¸­æ€§ 35%, è´Ÿé¢ 20%")
        
        # æ¼”ç¤ºç”¨æˆ·å…³æ³¨åº¦æ•°æ®åŒæ­¥
        print("\nğŸ‘¥ 2. ç”¨æˆ·å…³æ³¨åº¦æ•°æ®åŒæ­¥æ¼”ç¤º")
        print("-" * 40)
        
        print("æ­£åœ¨åŒæ­¥ç”¨æˆ·å…³æ³¨åº¦æ•°æ®...")
        time.sleep(1)
        
        print("âœ… ç”¨æˆ·å…³æ³¨åº¦æ•°æ®åŒæ­¥å®Œæˆ")
        print("   - æœç´¢é‡æ•°æ®: 5,000 æ¡")
        print("   - è®¨è®ºçƒ­åº¦æ•°æ®: 3,200 æ¡")
        print("   - å¹³å‡å…³æ³¨åº¦è¯„åˆ†: 7.8/10")
        
        # æ¼”ç¤ºäººæ°”æ¦œæ•°æ®åŒæ­¥
        print("\nğŸ”¥ 3. äººæ°”æ¦œæ•°æ®åŒæ­¥æ¼”ç¤º")
        print("-" * 40)
        
        print("æ­£åœ¨åŒæ­¥äººæ°”æ¦œæ•°æ®...")
        time.sleep(1)
        
        print("âœ… äººæ°”æ¦œæ•°æ®åŒæ­¥å®Œæˆ")
        print("   - çƒ­é—¨è‚¡ç¥¨æ¦œ: 100 åª")
        print("   - æ´»è·ƒè‚¡ç¥¨æ¦œ: 100 åª")
        print("   - å…³æ³¨åº¦æ¦œ: 100 åª")
        print("   - æˆäº¤é‡æ¦œ: 100 åª")
        
        # è·å–åŒæ­¥çŠ¶æ€
        print("\nğŸ“Š 4. åŒæ­¥çŠ¶æ€æŸ¥è¯¢æ¼”ç¤º")
        print("-" * 40)
        
        status = syncer.get_sync_status()
        print("åŒæ­¥çŠ¶æ€æ‘˜è¦:")
        for data_type, info in status.items():
            print(f"   {data_type}: {info.get('status', 'unknown')} - {info.get('last_sync_time', 'N/A')}")
        
    except Exception as e:
        print(f"âŒ AkshareåŒæ­¥æ¼”ç¤ºå¤±è´¥: {e}")


def demo_industry_classification():
    """æ¼”ç¤ºç”³ä¸‡è¡Œä¸šåˆ†ç±»ç®¡ç†åŠŸèƒ½"""
    print("\n" + "=" * 60)
    print("ğŸ­ æ¼”ç¤º ç”³ä¸‡è¡Œä¸šåˆ†ç±»ç®¡ç†åŠŸèƒ½")
    print("=" * 60)
    
    try:
        # åˆ›å»ºè¡Œä¸šåˆ†ç±»ç®¡ç†å™¨
        manager = IndustryClassificationManager()
        
        # æ¼”ç¤ºè¡Œä¸šåˆ†ç±»æ•°æ®åŒæ­¥
        print("\nğŸ“‹ 1. è¡Œä¸šåˆ†ç±»æ•°æ®åŒæ­¥æ¼”ç¤º")
        print("-" * 40)
        
        print("æ­£åœ¨åŒæ­¥ç”³ä¸‡è¡Œä¸šåˆ†ç±»æ•°æ®...")
        time.sleep(1)
        
        print("âœ… è¡Œä¸šåˆ†ç±»æ•°æ®åŒæ­¥å®Œæˆ")
        print("   - L1çº§è¡Œä¸š: 28 ä¸ª")
        print("   - L2çº§è¡Œä¸š: 104 ä¸ª") 
        print("   - L3çº§è¡Œä¸š: 227 ä¸ª")
        
        # æ¼”ç¤ºè‚¡ç¥¨è¡Œä¸šå½’å±æ˜ å°„
        print("\nğŸ”— 2. è‚¡ç¥¨è¡Œä¸šå½’å±æ˜ å°„æ¼”ç¤º")
        print("-" * 40)
        
        print("æ­£åœ¨åŒæ­¥è‚¡ç¥¨è¡Œä¸šå½’å±æ˜ å°„...")
        time.sleep(1)
        
        print("âœ… è‚¡ç¥¨è¡Œä¸šå½’å±æ˜ å°„å®Œæˆ")
        print("   - æ˜ å°„è‚¡ç¥¨æ•°é‡: 5,000 åª")
        print("   - å†å²å˜æ›´è®°å½•: 1,200 æ¡")
        print("   - å½“å‰æœ‰æ•ˆæ˜ å°„: 4,800 æ¡")
        
        # æ¼”ç¤ºè¡Œä¸šæ•°æ®æŸ¥è¯¢
        print("\nğŸ” 3. è¡Œä¸šæ•°æ®æŸ¥è¯¢æ¼”ç¤º")
        print("-" * 40)
        
        # æ¨¡æ‹ŸæŸ¥è¯¢ç»“æœ
        sample_stock = "000001.SZ"
        print(f"æŸ¥è¯¢è‚¡ç¥¨ {sample_stock} çš„è¡Œä¸šå½’å±:")
        print("   L1çº§: é‡‘èæœåŠ¡ (801780.SI)")
        print("   L2çº§: é“¶è¡Œ (801790.SI)")
        print("   L3çº§: é“¶è¡ŒII (801791.SI)")
        print("   å½’å±æ—¥æœŸ: 2021-01-01")
        print("   å½“å‰çŠ¶æ€: æœ‰æ•ˆ")
        
        # æ¼”ç¤ºæ•°æ®å®Œæ•´æ€§éªŒè¯
        print("\nâœ… 4. æ•°æ®å®Œæ•´æ€§éªŒè¯æ¼”ç¤º")
        print("-" * 40)
        
        print("æ­£åœ¨éªŒè¯è¡Œä¸šæ•°æ®å®Œæ•´æ€§...")
        time.sleep(1)
        
        print("éªŒè¯ç»“æœ:")
        print("   - è¡Œä¸šåˆ†ç±»å®Œæ•´æ€§: 100%")
        print("   - è‚¡ç¥¨æ˜ å°„è¦†ç›–ç‡: 96%")
        print("   - å­¤å„¿è®°å½•æ•°é‡: 0")
        print("   - æ•°æ®è´¨é‡è¯„åˆ†: 0.96/1.0")
        
    except Exception as e:
        print(f"âŒ è¡Œä¸šåˆ†ç±»ç®¡ç†æ¼”ç¤ºå¤±è´¥: {e}")


def demo_incremental_update():
    """æ¼”ç¤ºæ™ºèƒ½å¢é‡æ›´æ–°åŠŸèƒ½"""
    print("\n" + "=" * 60)
    print("âš¡ æ¼”ç¤º æ™ºèƒ½å¢é‡æ›´æ–°å¼•æ“")
    print("=" * 60)
    
    try:
        # åˆ›å»ºå¢é‡æ›´æ–°ç®¡ç†å™¨
        manager = IncrementalUpdateManager()
        
        # æ¼”ç¤ºç¼ºå¤±æ•°æ®æ£€æµ‹
        print("\nğŸ” 1. ç¼ºå¤±æ•°æ®æ£€æµ‹æ¼”ç¤º")
        print("-" * 40)
        
        print("æ­£åœ¨æ£€æµ‹ç¼ºå¤±æ•°æ®...")
        time.sleep(1)
        
        print("æ£€æµ‹ç»“æœ:")
        print("   - dailyæ•°æ®: ç¼ºå¤± 3 ä¸ªäº¤æ˜“æ—¥")
        print("   - daily_basicæ•°æ®: ç¼ºå¤± 2 ä¸ªäº¤æ˜“æ—¥")
        print("   - news_sentimentæ•°æ®: ç¼ºå¤± 5 ä¸ªäº¤æ˜“æ—¥")
        print("   - user_attentionæ•°æ®: ç¼ºå¤± 4 ä¸ªäº¤æ˜“æ—¥")
        
        # æ¼”ç¤ºä»»åŠ¡è°ƒåº¦
        print("\nğŸ“… 2. æ™ºèƒ½ä»»åŠ¡è°ƒåº¦æ¼”ç¤º")
        print("-" * 40)
        
        print("æ­£åœ¨åˆ›å»ºåŒæ­¥ä»»åŠ¡...")
        
        # åˆ›å»ºç¤ºä¾‹ä»»åŠ¡
        task_id1 = manager.create_sync_task(
            'tushare', 'daily', '2024-01-01', 
            ['000001.SZ', '000002.SZ'], SyncPriority.HIGH
        )
        
        task_id2 = manager.create_sync_task(
            'akshare', 'news_sentiment', '2024-01-01',
            ['000001.SZ', '000002.SZ'], SyncPriority.NORMAL
        )
        
        print(f"âœ… åˆ›å»ºä»»åŠ¡: {task_id1} (ä¼˜å…ˆçº§: HIGH)")
        print(f"âœ… åˆ›å»ºä»»åŠ¡: {task_id2} (ä¼˜å…ˆçº§: NORMAL)")
        print(f"   - é˜Ÿåˆ—ä¸­ä»»åŠ¡æ•°: {len(manager.task_queue)}")
        
        # æ¼”ç¤ºä»»åŠ¡æ‰§è¡Œ
        print("\nâš™ï¸ 3. ä»»åŠ¡æ‰§è¡Œæ¼”ç¤º")
        print("-" * 40)
        
        print("æ­£åœ¨æ‰§è¡ŒåŒæ­¥ä»»åŠ¡...")
        time.sleep(2)
        
        print("æ‰§è¡Œç»“æœ:")
        print("   - æ€»ä»»åŠ¡æ•°: 2")
        print("   - æˆåŠŸä»»åŠ¡: 2")
        print("   - å¤±è´¥ä»»åŠ¡: 0")
        print("   - å¹³å‡æ‰§è¡Œæ—¶é—´: 0.8 ç§’")
        
        # æ¼”ç¤ºçŠ¶æ€ç›‘æ§
        print("\nğŸ“Š 4. çŠ¶æ€ç›‘æ§æ¼”ç¤º")
        print("-" * 40)
        
        print("åŒæ­¥çŠ¶æ€æ‘˜è¦:")
        print("   é˜Ÿåˆ—çŠ¶æ€:")
        print("     - å¾…å¤„ç†ä»»åŠ¡: 0")
        print("     - è¿è¡Œä¸­ä»»åŠ¡: 0") 
        print("     - å·²å®Œæˆä»»åŠ¡: 2")
        print("     - å¤±è´¥ä»»åŠ¡: 0")
        print("   æ•°æ®å®Œæ•´æ€§:")
        print("     - daily: 98.5% (ç¼ºå¤± 3/200 å¤©)")
        print("     - daily_basic: 99.0% (ç¼ºå¤± 2/200 å¤©)")
        print("     - news_sentiment: 97.5% (ç¼ºå¤± 5/200 å¤©)")
        
    except Exception as e:
        print(f"âŒ å¢é‡æ›´æ–°æ¼”ç¤ºå¤±è´¥: {e}")


def demo_unified_sync_manager():
    """æ¼”ç¤ºç»Ÿä¸€æ•°æ®åŒæ­¥ç®¡ç†åŠŸèƒ½"""
    print("\n" + "=" * 60)
    print("ğŸ¯ æ¼”ç¤º ç»Ÿä¸€æ•°æ®åŒæ­¥ç®¡ç†")
    print("=" * 60)
    
    try:
        # åˆ›å»ºç»Ÿä¸€åŒæ­¥ç®¡ç†å™¨
        manager = DataSyncManager()
        
        # æ¼”ç¤ºå¿«é€ŸåŒæ­¥
        print("\nâš¡ 1. å¿«é€ŸåŒæ­¥æ¼”ç¤º")
        print("-" * 40)
        
        print("æ­£åœ¨æ‰§è¡Œå¿«é€ŸåŒæ­¥ï¼ˆæœ€æ–°æ•°æ®ï¼‰...")
        time.sleep(2)
        
        print("âœ… å¿«é€ŸåŒæ­¥å®Œæˆ")
        print("   - åŒæ­¥æ•°æ®ç±»å‹: daily, daily_basic")
        print("   - æˆåŠŸç‡: 100%")
        print("   - æ€»è€—æ—¶: 1.8 ç§’")
        
        # æ¼”ç¤ºå®Œæ•´åŒæ­¥çŠ¶æ€
        print("\nğŸ“ˆ 2. å®Œæ•´åŒæ­¥çŠ¶æ€æ¼”ç¤º")
        print("-" * 40)
        
        print("æ•°æ®æºåŒæ­¥çŠ¶æ€:")
        print("   ğŸ“Š Tushare:")
        print("     - daily: âœ… æˆåŠŸ (2024-01-03 09:30:00)")
        print("     - daily_basic: âœ… æˆåŠŸ (2024-01-03 09:32:00)")
        print("     - financial: âœ… æˆåŠŸ (2024-01-03 08:00:00)")
        print("   ğŸ“° Akshare:")
        print("     - news_sentiment: âœ… æˆåŠŸ (2024-01-03 10:15:00)")
        print("     - user_attention: âœ… æˆåŠŸ (2024-01-03 10:18:00)")
        print("     - popularity_ranking: âœ… æˆåŠŸ (2024-01-03 10:20:00)")
        print("   ğŸ­ Industry:")
        print("     - industry_classification: âœ… æˆåŠŸ (2024-01-03 07:00:00)")
        print("     - stock_industry_mapping: âœ… æˆåŠŸ (2024-01-03 07:30:00)")
        
        # æ¼”ç¤ºç³»ç»Ÿå¥åº·è¯„åˆ†
        print("\nğŸ’š 3. ç³»ç»Ÿå¥åº·è¯„åˆ†")
        print("-" * 40)
        
        print("æ•°æ®å¥åº·è¯„åˆ†: 96.5%")
        print("è¯„åˆ†è¯¦æƒ…:")
        print("   - æ•°æ®å®Œæ•´æ€§: 98%")
        print("   - æ•°æ®æ—¶æ•ˆæ€§: 95%")
        print("   - åŒæ­¥æˆåŠŸç‡: 97%")
        print("   - ç³»ç»Ÿå¯ç”¨æ€§: 99%")
        
        print("\nå»ºè®®:")
        print("   âš ï¸  news_sentiment æ•°æ®æœ‰è½»å¾®å»¶è¿Ÿï¼Œå»ºè®®æ£€æŸ¥Akshare APIçŠ¶æ€")
        print("   âœ… å…¶ä»–æ•°æ®æºè¿è¡Œæ­£å¸¸")
        
    except Exception as e:
        print(f"âŒ ç»Ÿä¸€åŒæ­¥ç®¡ç†æ¼”ç¤ºå¤±è´¥: {e}")


def main():
    """ä¸»æ¼”ç¤ºå‡½æ•°"""
    print("ğŸ‰ æ¬¢è¿ä½¿ç”¨ StockSchool æ•°æ®åŒæ­¥å¢å¼ºåŠŸèƒ½æ¼”ç¤º")
    print("æœ¬æ¼”ç¤ºå°†å±•ç¤ºä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½:")
    print("1. Akshareæ•°æ®æºé›†æˆ - æƒ…ç»ªé¢æ•°æ®è·å–")
    print("2. ç”³ä¸‡è¡Œä¸šåˆ†ç±»ç®¡ç† - ä¸‰çº§è¡Œä¸šåˆ†ç±»ä½“ç³»")
    print("3. æ™ºèƒ½å¢é‡æ›´æ–°å¼•æ“ - ç¼ºå¤±æ•°æ®æ£€æµ‹å’Œæ™ºèƒ½åŒæ­¥")
    print("4. ç»Ÿä¸€æ•°æ®åŒæ­¥ç®¡ç† - å¤šæ•°æ®æºåè°ƒç®¡ç†")
    
    print("\næ³¨æ„: æœ¬æ¼”ç¤ºä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…éƒ¨ç½²æ—¶ä¼šè¿æ¥çœŸå®çš„æ•°æ®æºAPI")
    
    try:
        # æ‰§è¡Œå„ä¸ªåŠŸèƒ½æ¼”ç¤º
        demo_akshare_sync()
        demo_industry_classification()
        demo_incremental_update()
        demo_unified_sync_manager()
        
        # æ€»ç»“
        print("\n" + "=" * 60)
        print("ğŸŠ æ¼”ç¤ºå®Œæˆæ€»ç»“")
        print("=" * 60)
        
        print("\nâœ… å·²æˆåŠŸæ¼”ç¤ºçš„åŠŸèƒ½:")
        print("   1. âœ… Akshareæ•°æ®æºé›†æˆ")
        print("      - æ–°é—»æƒ…ç»ªæ•°æ®åŒæ­¥")
        print("      - ç”¨æˆ·å…³æ³¨åº¦æ•°æ®åŒæ­¥")
        print("      - äººæ°”æ¦œæ•°æ®åŒæ­¥")
        print("      - APIè°ƒç”¨é¢‘ç‡é™åˆ¶")
        print("      - æ•°æ®æ ‡å‡†åŒ–å¤„ç†")
        
        print("\n   2. âœ… ç”³ä¸‡è¡Œä¸šåˆ†ç±»ç®¡ç†")
        print("      - ä¸‰çº§è¡Œä¸šåˆ†ç±»æ•°æ®åŒæ­¥")
        print("      - è‚¡ç¥¨è¡Œä¸šå½’å±æ˜ å°„")
        print("      - å†å²å˜æ›´è·Ÿè¸ª")
        print("      - æ•°æ®å®Œæ•´æ€§éªŒè¯")
        
        print("\n   3. âœ… æ™ºèƒ½å¢é‡æ›´æ–°å¼•æ“")
        print("      - åŸºäºäº¤æ˜“æ—¥å†çš„ç¼ºå¤±æ•°æ®æ£€æµ‹")
        print("      - æ™ºèƒ½ä»»åŠ¡è°ƒåº¦å’Œä¼˜å…ˆçº§ç®¡ç†")
        print("      - å¹¶å‘ä»»åŠ¡æ‰§è¡Œ")
        print("      - åŒæ­¥çŠ¶æ€ç›‘æ§")
        
        print("\n   4. âœ… ç»Ÿä¸€æ•°æ®åŒæ­¥ç®¡ç†")
        print("      - å¤šæ•°æ®æºåè°ƒåŒæ­¥")
        print("      - ä¾èµ–å…³ç³»ç®¡ç†")
        print("      - ç³»ç»Ÿå¥åº·è¯„åˆ†")
        print("      - å¿«é€ŸåŒæ­¥æ¨¡å¼")
        
        print("\nğŸš€ æ ¸å¿ƒä¼˜åŠ¿:")
        print("   - ğŸ¯ æ™ºèƒ½åŒ–: è‡ªåŠ¨æ£€æµ‹ç¼ºå¤±æ•°æ®ï¼Œæ™ºèƒ½è°ƒåº¦åŒæ­¥ä»»åŠ¡")
        print("   - ğŸ”„ å¯é æ€§: é‡è¯•æœºåˆ¶ã€é”™è¯¯å¤„ç†ã€çŠ¶æ€æŒä¹…åŒ–")
        print("   - âš¡ é«˜æ•ˆæ€§: å¹¶å‘æ‰§è¡Œã€å¢é‡æ›´æ–°ã€APIé¢‘ç‡æ§åˆ¶")
        print("   - ğŸ“Š å¯è§‚æµ‹: è¯¦ç»†çŠ¶æ€ç›‘æ§ã€è´¨é‡è¯„åˆ†ã€æ€§èƒ½ç»Ÿè®¡")
        print("   - ğŸ”§ å¯æ‰©å±•: æ¨¡å—åŒ–è®¾è®¡ã€æ’ä»¶åŒ–æ¶æ„ã€é…ç½®é©±åŠ¨")
        
        print("\nğŸ“ ä¸‹ä¸€æ­¥å»ºè®®:")
        print("   1. é…ç½®çœŸå®çš„APIå¯†é’¥ (TUSHARE_TOKEN)")
        print("   2. éƒ¨ç½²TimescaleDBæ•°æ®åº“")
        print("   3. è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬")
        print("   4. æ‰§è¡Œå®Œæ•´æ•°æ®åŒæ­¥æµ‹è¯•")
        print("   5. é…ç½®å®šæ—¶ä»»åŠ¡è¿›è¡Œæ—¥å¸¸åŒæ­¥")
        
        print(f"\nğŸ‰ æ¼”ç¤ºæˆåŠŸå®Œæˆ! æ„Ÿè°¢ä½¿ç”¨ StockSchool æ•°æ®åŒæ­¥å¢å¼ºåŠŸèƒ½")
        
    except Exception as e:
        print(f"\nâŒ æ¼”ç¤ºè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: {e}")
        print("è¯·æ£€æŸ¥ç¯å¢ƒé…ç½®å’Œä¾èµ–å®‰è£…")


if __name__ == '__main__':
    main()