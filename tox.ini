[tox]
envlist = py38,py39,py310,py311,flake8,mypy,coverage
isolated_build = true

[testenv]
deps = 
    pytest>=7.4.0
    pytest-asyncio>=0.21.0
    pytest-cov>=4.1.0
    pytest-mock>=3.11.0
    pytest-xdist>=3.3.0
    -r{toxinidir}/requirements.txt
commands = 
    pytest {posargs:tests/}

[testenv:py38]
basepython = python3.8

[testenv:py39]
basepython = python3.9

[testenv:py310]
basepython = python3.10

[testenv:py311]
basepython = python3.11

[testenv:flake8]
deps = 
    flake8>=6.0.0
    flake8-docstrings>=1.7.0
    flake8-import-order>=0.18.0
commands = 
    flake8 src tests

[testenv:mypy]
deps = 
    mypy>=1.5.0
    types-requests
    types-redis
    -r{toxinidir}/requirements.txt
commands = 
    mypy src

[testenv:black]
deps = 
    black>=23.0.0
commands = 
    black --check --diff src tests

[testenv:isort]
deps = 
    isort>=5.12.0
commands = 
    isort --check-only --diff src tests

[testenv:coverage]
deps = 
    pytest>=7.4.0
    pytest-cov>=4.1.0
    coverage>=7.3.0
    -r{toxinidir}/requirements.txt
commands = 
    pytest --cov=src --cov-report=term-missing --cov-report=html --cov-report=xml --cov-fail-under=80

[testenv:docs]
deps = 
    sphinx>=7.1.0
    sphinx-rtd-theme>=1.3.0
    myst-parser>=2.0.0
commands = 
    sphinx-build -W -b html docs docs/_build/html

[testenv:acceptance]
deps = 
    pytest>=7.4.0
    pytest-asyncio>=0.21.0
    pytest-cov>=4.1.0
    -r{toxinidir}/requirements.txt
commands = 
    python run_integration_tests.py

[testenv:performance]
deps = 
    pytest>=7.4.0
    pytest-benchmark>=4.0.0
    -r{toxinidir}/requirements.txt
commands = 
    pytest -m performance tests/performance/

[testenv:security]
deps = 
    bandit>=1.7.0
    safety>=2.3.0
commands = 
    bandit -r src
    safety check

[testenv:lint]
deps = 
    flake8>=6.0.0
    black>=23.0.0
    isort>=5.12.0
    mypy>=1.5.0
commands = 
    flake8 src tests
    black --check src tests
    isort --check-only src tests
    mypy src

[testenv:format]
deps = 
    black>=23.0.0
    isort>=5.12.0
commands = 
    black src tests
    isort src tests

[testenv:clean]
deps = 
commands = 
    python -c "import shutil; shutil.rmtree('build', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('dist', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.tox', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('htmlcov', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.coverage', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('.pytest_cache', ignore_errors=True)"
    python -c "import shutil; shutil.rmtree('__pycache__', ignore_errors=True)"

[flake8]
max-line-length = 88
extend-ignore = E203, W503, E501
exclude = 
    .git,
    __pycache__,
    docs/source/conf.py,
    old,
    build,
    dist,
    .venv,
    venv,
    .tox,
    .eggs,
    *.egg

[coverage:run]
source = src
omit = 
    */tests/*
    */test_*
    */__pycache__/*
    */migrations/*
    */venv/*
    */env/*

[coverage:report]
exclude_lines = 
    pragma: no cover
    def __repr__
    if self.debug:
    if settings.DEBUG
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:
    class .*\bProtocol\):
    @(abc\.)?abstractmethod