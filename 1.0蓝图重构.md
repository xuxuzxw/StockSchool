# StockSchool 1.0 蓝图重构

## 技术栈要求
- [✓] Python 版本为 `3.11`
- [✓] 启用 TimescaleDB 扩展，数据库镜像版本为 `timescale/timescaledb:latest-pg15`
- [✓] TUSHARE_TOKEN 在环境变量中配置
- [✓] 按 `stock_code` + `end_date` 建立复合索引

## 1. 数据层设计

### 1.1 数据更新策略
- [✓] **增量更新机制**：使用`trade_cal`接口获取交易日历，仅更新缺失交易日数据
- [✓] **情绪数据**：Akshare情绪数据每日更新一次，采用覆盖式存储
- [✓] 日更新数据表示每天存一次，所有按天存储的数据都是检测到有了就等第二天再存

### 1.2 行业分类标准
- [✓] **申万行业分类**：通过Tushare的`index_classify`和`index_member`接口实现（功能已在tushare_sync.py中实现，无需专门的industry_sync.py）
- [✓] 行业数据更新逻辑已在tushare_sync.py中部分实现
- [✓] 行业同步测试脚本（test_sw_industry_sync.py）已实现

### 1.3 数据宽度与长度
- [✓] **数据宽度**：Tushare为主，Akshare为辅
- [✓] **数据长度**：尽可能长，Tushare日线行情等接口提供长达20年数据

## 2. 数据库设计

### 2.1 核心优化
- [✓] **复合索引策略**：按 `stock_code` + `end_date` 建立复合索引
- [✓] **分区表设计**：使用TimescaleDB的`create_hypertable`函数按时间维度分片

### 2.2 性能优化
- [✓] 为行业分类表添加复合索引
- [✓] 对高频访问表`daily_basic`添加部分索引

### 2.3 容器化部署准备
- [✓] Dockerfile和docker-compose.yml配置已完成

### 2.4 数据库初始化流程
- [✓] 支持命令行参数、交互式菜单和手动执行SQL脚本三种初始化方式

## 3. 因子计算架构

### 3.1 数据质量监控
- [✓] **异常值检测**：实现3σ原则检测异常值
- [✓] **缺失值处理**：采用前向填充+行业均值填充的混合策略
- [✓] 数据质量监控功能已在quality.py中实现

### 3.2 计算资源隔离
- [✓] 使用Celery实现因子计算任务队列（已实现，位于src/compute/tasks.py）

### 3.3 幂等性设计
- [✓] 添加数据同步重试机制

### 3.4 测试框架
- [✓] 添加单元测试和集成测试

### 3.5 监控告警系统
- [✓] 实现数据异常告警机制
- [✓] 告警系统基础架构已在alerts.py中实现

### 3.6 特征商店(Feature Store)
- [✓] 特征商店架构设计已完成
- [✓] FeatureStore类已在feature_store.py中实现

## 4. AI与策略模块

### 4.1 模型解释性
- [ ] 集成SHAP值分析模块（未实现）

### 4.2 策略评估体系
- [✓] 实现完整的业绩归因分析
- [✓] 策略评估功能已在evaluation.py中实现

### 4.3 AI预测与训练模块（实际新增功能）
- [✓] 基于训练模型的股票预测功能已在prediction.py中实现
- [✓] AI模型训练流水线已在training_pipeline.py中实现
- [✓] 多种机器学习模型训练和评估逻辑已在ai_model.py中实现

## 5. 系统监控与管理

### 5.1 校长驾驶舱
- [ ] 监控看板实现（未完全实现）
- [ ] 策略分析界面（未实现）

### 5.2 日志系统
- [✓] 实现文件+数据库双写日志机制

### 5.3 系统性能监控模块（实际新增功能）
- [✓] 系统性能监控功能已在performance.py中实现

### 5.4 API文档生成
- [ ] 使用mkdocs构建自动化文档（未实现）

## 6. 因子计算的划分
- [✓] **数据层**：负责从Tushare和Akshare接口获取原始数据并存入数据库
- [✓] **技术面组**：计算动量、波动率、EMA、RSI等指标
- [✓] **基本面组**：计算估值（PE, PB）、成长性、盈利能力等因子
- [✓] **情绪面组**：计算热度、资金博弈、关注度等因子
- [✓] **打分与标准化**：在行业内部进行标准化以消除行业差异

## 7. 已完成但蓝图未规划的功能
- [✓] AI预测与训练模块（prediction.py、training_pipeline.py）
- [✓] 策略评估模块（evaluation.py）
- [✓] 系统性能监控模块（performance.py）
- [✓] 行业同步测试脚本（test_sw_industry_sync.py）